<!--
  ============================================================
  BESMA Safety Platform - High-Fidelity Prototype
  System Architecture & Logic Designed by Jung Sangik
  Â© 2025 All Rights Reserved.
  
  This prototype demonstrates the patentable "Personalized AI Safety Loop"
  logic for construction safety management platforms.
  ============================================================
-->
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>presentation_demo - Work Order &amp; Mobile TBM Prototype</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg-main: #f3f4f6;
      --bg-card: #ffffff;
      --navy: #0f172a;
      --navy-soft: #111827;
      --blue: #2563eb;
      --blue-soft: #dbeafe;
      --border-subtle: #e5e7eb;
      --text-main: #111827;
      --text-muted: #6b7280;
      --danger: #ef4444;
      --accent-green: #22c55e;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
        "Noto Sans KR", "Apple SD Gothic Neo", "Malgun Gothic", sans-serif;
      background: var(--bg-main);
      color: var(--text-main);
    }

    .app-root {
      display: flex;
      height: 100vh;
      overflow: hidden;
    }

    /* ë¡œê·¸ì¸ ì˜¤ë²„ë ˆì´ */
    .login-overlay {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at top, #020617, #000000);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 20;
    }

    .login-card {
      width: 340px;
      padding: 28px 24px 22px;
      border-radius: 20px;
      background: linear-gradient(145deg, #020617, #020617, #0b1120);
      box-shadow: 0 26px 80px rgba(15, 23, 42, 0.9);
      color: #e5e7eb;
      position: relative;
      overflow: hidden;
    }

    .login-card::before {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        radial-gradient(circle at 0 0, rgba(56, 189, 248, 0.35), transparent 60%),
        radial-gradient(circle at 100% 0, rgba(37, 99, 235, 0.35), transparent 60%);
      pointer-events: none;
    }

    .login-inner {
      position: relative;
      z-index: 1;
    }

    .login-watermark {
      position: absolute;
      right: 50%;
      top: 140px;
      transform: translateX(50%);
      width: 200px;
      opacity: 0.35;
      pointer-events: none;
      filter: saturate(1.1);
      z-index: 0;
    }

    .login-logo {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 16px;
    }

    .login-logo-img {
      width: 32px;
      height: 32px;
      object-fit: contain;
    }

    .login-title-main {
      font-size: 15px;
      font-weight: 600;
      letter-spacing: 0.05em;
    }

    .login-title-sub {
      font-size: 11px;
      color: #9ca3af;
    }

    .login-heading {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .login-desc {
      font-size: 12px;
      color: #9ca3af;
      margin-bottom: 16px;
    }

    .field {
      margin-bottom: 12px;
    }

    .field label {
      display: block;
      font-size: 12px;
      margin-bottom: 4px;
    }

    .field input {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.9);
      color: #e5e7eb;
      font-size: 13px;
      outline: none;
    }

    .field input:focus {
      border-color: #38bdf8;
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.7);
    }

    .login-hint {
      font-size: 11px;
      color: #9ca3af;
      margin-bottom: 10px;
    }

    .login-hint code {
      background: rgba(15, 23, 42, 0.9);
      padding: 2px 6px;
      border-radius: 6px;
      border: 1px solid rgba(148, 163, 184, 0.5);
    }

    .login-button {
      width: 100%;
      border-radius: 999px;
      border: none;
      padding: 10px 0;
      color: #020617;
      font-size: 14px;
      font-weight: 600;
      background: linear-gradient(135deg, #22c55e, #a3e635);
      box-shadow: 0 18px 50px rgba(22, 163, 74, 0.8);
      cursor: pointer;
      margin-top: 4px;
    }

    .login-meta {
      margin-top: 14px;
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      color: #9ca3af;
    }

    /* ì‚¬ì´ë“œë°” */
    .sidebar {
      width: 250px;
      background: #020617;
      color: #e5e7eb;
      display: flex;
      flex-direction: column;
      padding: 16px 14px 14px;
      border-right: 1px solid #111827;
      position: relative;
      z-index: 10;
    }

    .sidebar-header {
      margin-bottom: 16px;
    }

    .sidebar-title-main {
      font-size: 14px;
      font-weight: 700;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .sidebar-title-sub {
      font-size: 11px;
      color: #9ca3af;
      margin-top: 2px;
    }

    .sidebar-section-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #64748b;
      margin: 10px 2px 6px;
    }

    .menu-list {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .menu-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 9px;
      border-radius: 10px;
      font-size: 13px;
      cursor: pointer;
      color: #e5e7eb;
      margin: 1px 0;
      transition: background 0.12s, transform 0.08s;
    }

    .menu-item-icon {
      width: 18px;
      height: 18px;
      border-radius: 6px;
      background: rgba(15, 23, 42, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
    }

    .menu-item span {
      flex: 1;
      white-space: nowrap;
    }

    .menu-badge {
      min-width: 16px;
      height: 16px;
      padding: 0 4px;
      border-radius: 999px;
      background: #dc2626;
      color: #fee2e2;
      font-size: 10px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .menu-item.active {
      background: linear-gradient(135deg, #2563eb, #4f46e5);
      box-shadow: 0 10px 26px rgba(37, 99, 235, 0.8);
      transform: translateY(-1px);
    }

    .menu-item.active .menu-item-icon {
      background: rgba(15, 23, 42, 0.95);
    }

    .menu-item:hover:not(.active) {
      background: rgba(31, 41, 55, 0.9);
    }

    .sidebar-footer {
      margin-top: auto;
      font-size: 11px;
      color: #e5e7eb;
      padding: 12px 16px;
      border-top: 1px solid rgba(229, 231, 235, 0.1);
      background: rgba(15, 23, 42, 0.5);
    }

    .sidebar-footer div {
      font-weight: 600;
      color: #ffffff;
      margin-bottom: 4px;
    }

    .sidebar-footer small {
      display: block;
      margin-top: 4px;
      color: #9ca3af;
      line-height: 1.4;
    }

    /* ë©”ì¸ ë ˆì´ì•„ì›ƒ */
    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: #f9fafb;
    }

    .topbar {
      padding: 12px 18px 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid var(--border-subtle);
      background: rgba(249, 250, 251, 0.9);
      backdrop-filter: blur(10px);
    }

    .topbar-left {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .topbar-title {
      font-size: 17px;
      font-weight: 700;
      color: var(--navy-soft);
    }

    .topbar-sub {
      font-size: 12px;
      color: var(--text-muted);
    }

    .topbar-right {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 12px;
    }

    .global-logo-small {
      width: 30px;
      height: 30px;
      object-fit: contain;
      border-radius: 8px;
    }

    .pill-soft {
      padding: 3px 9px;
      border-radius: 999px;
      background: #e5f0ff;
      color: #1d4ed8;
      border: 1px solid #bfdbfe;
    }

    .avatar {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      background: linear-gradient(135deg, #0ea5e9, #6366f1);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 13px;
      font-weight: 600;
      box-shadow: 0 0 0 2px #e5f0ff;
    }

    /* ê³ ì • ê³µì§€ì‚¬í•­ ì˜ì—­ */
    .notice-bar {
      width: 100%;
      background: linear-gradient(90deg, #1e293b, #334155);
      border-bottom: 2px solid #facc15;
      color: #facc15;
      font-size: 11px;
      padding: 6px 18px;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 2px 8px rgba(250, 204, 21, 0.2);
      animation: noticeBlink 1.4s ease-in-out infinite;
      position: relative;
      z-index: 1;
      cursor: pointer;
      transition: background 0.2s;
    }

    .notice-bar:hover {
      background: linear-gradient(90deg, #334155, #475569);
    }

    .notice-icon {
      font-size: 14px;
      flex-shrink: 0;
    }

    .notice-text {
      font-weight: 600;
      flex: 1;
    }

    /* ìƒë‹¨ ê³µí†µ íƒ€ì„ë¼ì¸ ë‰´ìŠ¤ ë°” */
    .timeline-bar {
      width: 100%;
      border-bottom: 1px solid #e5e7eb;
      background: linear-gradient(90deg, #0f172a, #1f2937);
      color: #e5e7eb;
      font-size: 11px;
      overflow: hidden;
    }

    .timeline-inner {
      display: inline-flex;
      gap: 40px;
      padding: 4px 18px;
      white-space: nowrap;
      animation: newsTicker 28s linear infinite;
    }

    .timeline-inner span {
      opacity: 0.9;
    }

    @keyframes newsTicker {
      0% {
        transform: translateX(0);
      }
      100% {
        transform: translateX(-50%);
      }
    }

    @keyframes noticeBlink {
      0%,
      100% {
        opacity: 1;
        text-shadow: 0 0 0 rgba(250, 204, 21, 0.0);
      }
      50% {
        opacity: 1;
        text-shadow: 0 0 8px rgba(250, 204, 21, 0.9);
      }
    }

    .main-content {
      flex: 1;
      padding: 16px 18px 18px;
      overflow: auto;
    }

    .view {
      display: none;
      height: 100%;
    }

    .view.active {
      display: block;
    }

    .card {
      background: var(--bg-card);
      border-radius: 18px;
      padding: 14px 16px 16px;
      box-shadow: 0 16px 50px rgba(15, 23, 42, 0.12);
      border: 1px solid rgba(148, 163, 184, 0.25);
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .card-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--navy-soft);
    }

    .card-sub {
      font-size: 11px;
      color: var(--text-muted);
    }

    .chip {
      padding: 3px 8px;
      border-radius: 999px;
      background: var(--blue-soft);
      color: var(--blue);
      font-size: 10px;
      border: 1px solid #bfdbfe;
    }

    /* ì‘ì—…ì§€ì‹œ í…Œì´ë¸” */
    .table-wrapper {
      max-width: 1080px;
      margin: 0 auto;
    }

    /* ìœ„í—˜ì„±í‰ê°€ DB ì†ŒìŠ¤ ì„ íƒ ì»¨íŠ¸ë¡¤ ë°” */
    .db-source-control-bar {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      background: #f8fafc;
      border-top: 1px solid #e5e7eb;
      border-bottom: 1px solid #e5e7eb;
      margin-top: 8px;
    }

    .db-source-label {
      font-size: 12px;
      font-weight: 600;
      color: var(--navy-soft);
      white-space: nowrap;
    }

    .db-source-select {
      flex: 1;
      max-width: 400px;
      padding: 6px 10px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      background: #ffffff;
      color: #111827;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .db-source-select:hover {
      border-color: #2563eb;
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.1);
    }

    .db-source-select:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2);
    }

    .db-source-badge {
      padding: 4px 10px;
      border-radius: 999px;
      background: #dcfce7;
      color: #166534;
      font-size: 11px;
      font-weight: 600;
      white-space: nowrap;
    }

    .db-source-badge.client {
      background: #dbeafe;
      color: #1e40af;
    }

    .db-source-badge.custom {
      background: #fef3c7;
      color: #92400e;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
      margin-top: 8px;
    }

    th,
    td {
      padding: 7px 8px;
      border-bottom: 1px solid #e5e7eb;
      text-align: left;
      white-space: nowrap;
    }

    th {
      background: #eff6ff;
      color: #1d4ed8;
      font-weight: 600;
      border-bottom: 1px solid #bfdbfe;
    }

    tr:nth-child(even) td {
      background: #f9fafb;
    }

    .status-badge {
      padding: 4px 8px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 11px;
    }

    .status-wait {
      background: #fef3c7;
      color: #92400e;
    }

    .status-signed {
      background: #dcfce7;
      color: #166534;
      cursor: default;
    }

    .feedback-cell {
      text-align: center;
      font-size: 11px;
      position: relative;
    }

    .feedback-icon {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 8px;
      border-radius: 6px;
      background: #eff6ff;
      color: #1d4ed8;
      font-weight: 600;
      cursor: pointer;
      position: relative;
      transition: all 0.2s;
    }

    .feedback-icon:hover {
      background: #dbeafe;
      transform: scale(1.05);
    }

    .feedback-tooltip {
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      margin-bottom: 8px;
      padding: 8px 12px;
      background: #1f2937;
      color: #e5e7eb;
      border-radius: 8px;
      font-size: 11px;
      white-space: nowrap;
      max-width: 250px;
      white-space: normal;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      z-index: 1000;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.2s;
    }

    .feedback-icon:hover .feedback-tooltip {
      opacity: 1;
    }

    .ai-alert-icon {
      padding: 4px 8px;
      border-radius: 6px;
      border: 1px solid #dc2626;
      background: #fee2e2;
      color: #991b1b;
      font-size: 10px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
    }

    .ai-alert-icon:hover {
      background: #fecaca;
      transform: scale(1.05);
      box-shadow: 0 2px 8px rgba(220, 38, 38, 0.3);
    }

    .thumb-img {
      width: 56px;
      height: 36px;
      object-fit: cover;
      border-radius: 6px;
      border: 1px solid #e5e7eb;
    }

    .task-input {
      width: 100%;
      border-radius: 6px;
      border: 1px solid #d4d4d8;
      padding: 3px 6px;
      font-size: 11px;
      box-sizing: border-box;
    }

    .task-input:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.5);
    }

    .task-suggest-list {
      position: absolute;
      left: 0;
      right: 0;
      top: 100%;
      margin-top: 2px;
      background: #ffffff;
      border-radius: 6px;
      border: 1px solid #e5e7eb;
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.15);
      z-index: 5;
      font-size: 11px;
      max-height: 150px;
      overflow: auto;
      display: none;
    }

    .task-suggest-item {
      padding: 4px 6px;
      cursor: pointer;
    }

    .task-suggest-item:hover {
      background: #eff6ff;
    }

    /* TBM ëª¨ë°”ì¼ ëª¨ë‹¬ */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.55);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 30;
    }

    .modal-phone {
      width: 340px;
      max-width: 90vw;
      height: 720px;
      max-height: 85vh;
      background: #020617;
      border-radius: 28px;
      padding: 12px 12px 18px;
      box-shadow: 0 30px 80px rgba(0, 0, 0, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.6);
      color: #e5e7eb;
      position: relative;
      display: flex;
      flex-direction: column;
    }

    .modal-phone-notch {
      width: 110px;
      height: 18px;
      border-radius: 999px;
      background: #020617;
      border: 1px solid #111827;
      margin: 0 auto 10px;
    }

    .modal-phone-inner {
      background: radial-gradient(circle at top, #111827, #020617 60%);
      border-radius: 20px;
      padding: 12px;
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .modal-phone-inner::-webkit-scrollbar {
      width: 4px;
    }

    .modal-phone-inner::-webkit-scrollbar-track {
      background: rgba(15, 23, 42, 0.5);
      border-radius: 2px;
    }

    .modal-phone-inner::-webkit-scrollbar-thumb {
      background: rgba(148, 163, 184, 0.5);
      border-radius: 2px;
    }

    .modal-phone-inner::-webkit-scrollbar-thumb:hover {
      background: rgba(148, 163, 184, 0.7);
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
      font-size: 13px;
    }

    .modal-header-title {
      font-weight: 700;
    }

    .modal-section-title {
      font-size: 11px;
      color: #9ca3af;
      margin-bottom: 4px;
    }

    .modal-box {
      border-radius: 12px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(55, 65, 81, 0.9);
      padding: 8px 9px;
      margin-bottom: 8px;
      font-size: 11px;
    }

    .modal-task-main {
      font-weight: 600;
      margin-bottom: 3px;
    }

    .modal-photo {
      width: 100%;
      border-radius: 10px;
      border: 1px solid #4b5563;
      object-fit: cover;
      max-height: 160px;
    }

    .modal-location-map {
      width: 100%;
      height: 140px;
      border-radius: 10px;
      border: 1px solid #4b5563;
      background-image: url("map2.jpg");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      position: relative;
      overflow: hidden;
    }

    .modal-location-label {
      position: absolute;
      left: 8px;
      bottom: 6px;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.85);
      color: #e5e7eb;
      font-size: 10px;
    }

    .modal-risk-list {
      padding-left: 16px;
      margin: 4px 0 0;
    }

    .modal-risk-list li {
      margin-bottom: 2px;
    }

    .modal-feedback-section {
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid rgba(55, 65, 81, 0.5);
    }

    .modal-feedback-label {
      font-size: 10px;
      color: #9ca3af;
      margin-bottom: 6px;
    }

    .modal-feedback-input-wrapper {
      display: flex;
      gap: 6px;
      align-items: flex-start;
    }

    .modal-feedback-input {
      flex: 1;
      min-height: 50px;
      border-radius: 8px;
      border: 1px solid #4b5563;
      background: #020617;
      color: #e5e7eb;
      font-size: 11px;
      padding: 6px 8px;
      resize: vertical;
      font-family: inherit;
    }

    .modal-feedback-input:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.3);
    }

    .modal-feedback-voice-btn {
      width: 36px;
      height: 36px;
      border-radius: 8px;
      border: 1px solid #4b5563;
      background: rgba(15, 23, 42, 0.9);
      color: #e5e7eb;
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      transition: all 0.2s;
    }

    .modal-feedback-voice-btn:hover {
      background: rgba(37, 99, 235, 0.2);
      border-color: #2563eb;
    }

    .modal-feedback-voice-btn:active {
      transform: scale(0.95);
    }

    .modal-sign-row {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .modal-worker-avatar {
      position: relative;
      width: 34px;
      height: 34px;
      flex-shrink: 0;
    }

    .modal-worker-img {
      width: 34px;
      height: 34px;
      border-radius: 999px;
      object-fit: cover;
      border: 2px solid #22c55e;
      background: #020617;
    }

    .modal-worker-placeholder {
      position: absolute;
      inset: 0;
      border-radius: 999px;
      border: 2px solid #22c55e;
      background: #020617;
      display: none;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }

    .modal-worker-name {
      font-size: 12px;
      font-weight: 600;
    }

    .modal-sign-button {
      margin-top: 8px;
      width: 100%;
      padding: 9px 0;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #022c22;
      font-size: 13px;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 16px 40px rgba(22, 163, 74, 0.9);
    }

    .modal-close-x {
      position: absolute;
      right: 18px;
      top: 10px;
      font-size: 13px;
      cursor: pointer;
      color: #9ca3af;
    }

    .modal-question-box {
      border-radius: 10px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(55, 65, 81, 0.9);
      padding: 8px 9px;
      margin-bottom: 8px;
      font-size: 11px;
    }

    .modal-question-actions {
      margin-top: 6px;
      display: flex;
      gap: 6px;
    }

    .modal-question-btn {
      flex: 1;
      padding: 6px 0;
      border-radius: 999px;
      border: 1px solid #4b5563;
      font-size: 11px;
      cursor: pointer;
      background: #020617;
      color: #e5e7eb;
    }

    .modal-question-btn.primary {
      background: #e5e7eb;
      color: #020617;
      border-color: #e5e7eb;
    }

    .modal-extra-risk-box {
      margin-top: 6px;
      display: none;
      flex-direction: column;
      gap: 4px;
    }

    .modal-extra-risk-box textarea {
      width: 100%;
      min-height: 46px;
      border-radius: 8px;
      border: 1px solid #4b5563;
      background: #020617;
      color: #e5e7eb;
      font-size: 11px;
      resize: vertical;
      font-family: inherit;
    }

    .modal-extra-save-btn {
      align-self: flex-end;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid #22c55e;
      background: rgba(16, 185, 129, 0.1);
      color: #bbf7d0;
      font-size: 11px;
      cursor: pointer;
    }

    .signature-area {
      margin-top: 8px;
      display: none;
      flex-direction: column;
      gap: 4px;
    }

    .signature-canvas-wrap {
      border-radius: 10px;
      border: 1px solid #4b5563;
      background: #020617;
      overflow: hidden;
    }

    #signatureCanvas {
      width: 100%;
      height: 120px;
      display: block;
      touch-action: none;
      cursor: crosshair;
    }

    .signature-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 10px;
      color: #9ca3af;
    }

    .signature-clear-btn {
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid #4b5563;
      background: #020617;
      color: #e5e7eb;
      cursor: pointer;
      font-size: 10px;
    }

    /* Toast Message for Worker Feedback */
    .toast-message {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #ecfdf5;
      padding: 12px 20px;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(34, 197, 94, 0.4);
      font-size: 13px;
      font-weight: 600;
      z-index: 10000;
      animation: toastSlideUp 0.3s ease-out, toastFadeOut 0.3s ease-in 2.7s forwards;
      white-space: nowrap;
    }

    @keyframes toastSlideUp {
      from {
        opacity: 0;
        transform: translateX(-50%) translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
    }

    @keyframes toastFadeOut {
      to {
        opacity: 0;
        transform: translateX(-50%) translateY(-10px);
      }
    }

    /* ê¸°íƒ€ ë·°ëŠ” ê°„ë‹¨í•œ í”Œë ˆì´ìŠ¤í™€ë” */
    .placeholder-text {
      font-size: 13px;
      color: var(--text-muted);
    }

    /* ê³µì§€ì‚¬í•­ ê²Œì‹œíŒ */
    .notice-board {
      margin-top: 12px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .notice-item {
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 14px 16px;
      background: #ffffff;
      transition: all 0.2s;
      cursor: pointer;
    }

    .notice-item:hover {
      border-color: #2563eb;
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.1);
      transform: translateY(-1px);
    }

    .notice-item-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 12px;
      margin-bottom: 6px;
    }

    .notice-item-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--navy-soft);
      flex: 1;
      line-height: 1.4;
    }

    .notice-item-badge {
      padding: 3px 8px;
      border-radius: 999px;
      background: #fee2e2;
      color: #991b1b;
      font-size: 10px;
      font-weight: 600;
      white-space: nowrap;
    }

    .notice-item-date {
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .notice-item-content {
      font-size: 12px;
      color: #4b5563;
      line-height: 1.6;
    }

    /* ë³¸ì‚¬ ëŒ€ì‹œë³´ë“œ (map1.jpg + ìš°ì¸¡ KPI/í‘œ) */
    .hq-dashboard {
      max-width: 1180px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1.6fr 1.2fr;
      gap: 16px;
      height: calc(100vh - 140px);
      max-height: 560px;
    }

    .hq-map-card {
      border-radius: 18px;
      overflow: hidden;
      box-shadow: 0 16px 45px rgba(15, 23, 42, 0.16);
      border: 1px solid #d4d4d8;
      background: #0b1120;
      position: relative;
    }

    .hq-map-bg {
      position: absolute;
      inset: 0;
      background-image: url("map1.jpg");
      background-size: contain;
      background-position: center;
      background-repeat: no-repeat;
      background-color: #0b1120;
      filter: saturate(1.05);
    }

    .hq-map-overlay {
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.25), transparent 55%);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 10px 14px 12px;
      color: #f9fafb;
      z-index: 1;
      pointer-events: none;
    }

    .hq-map-header,
    .hq-map-footer {
      pointer-events: auto;
    }

    .hq-map-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 13px;
    }

    .hq-map-header span {
      opacity: 0.9;
    }

    .hq-map-title {
      font-weight: 700;
      font-size: 15px;
    }

    .hq-map-badge {
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(191, 219, 254, 0.9);
      background: rgba(15, 23, 42, 0.7);
      font-size: 10px;
    }

    .hq-map-footer {
      display: flex;
      justify-content: space-between;
      font-size: 11px;
    }

    .hq-map-click-layer {
      position: absolute;
      inset: 0;
      cursor: pointer;
      z-index: 10;
      background: transparent;
    }

    .hq-kpi-row {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
      font-size: 11px;
    }

    .hq-kpi-pill {
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.85);
      border: 1px solid rgba(148, 163, 184, 0.8);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .hq-kpi-label {
      opacity: 0.85;
    }

    .hq-kpi-value {
      font-weight: 600;
    }

    .hq-right-card {
      border-radius: 18px;
      background: #ffffff;
      box-shadow: 0 16px 45px rgba(15, 23, 42, 0.12);
      border: 1px solid #e5e7eb;
      padding: 12px 14px 12px;
      display: flex;
      flex-direction: column;
      font-size: 12px;
    }

    .hq-right-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .hq-right-title {
      font-size: 14px;
      font-weight: 600;
      color: #111827;
    }

    .hq-right-sub {
      font-size: 11px;
      color: #6b7280;
    }

    .hq-stat-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
      margin-bottom: 10px;
    }

    .hq-stat-card {
      border-radius: 12px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      padding: 6px 8px;
    }

    .hq-stat-label {
      font-size: 11px;
      color: #6b7280;
    }

    .hq-stat-value {
      margin-top: 2px;
      font-size: 14px;
      font-weight: 700;
      color: #111827;
    }

    .hq-stat-desc {
      margin-top: 2px;
      font-size: 10px;
      color: #9ca3af;
    }

    .hq-bar-track {
      margin-top: 4px;
      width: 100%;
      height: 6px;
      border-radius: 999px;
      background: #e5e7eb;
      overflow: hidden;
    }

    .hq-bar-fill {
      height: 100%;
      border-radius: 999px;
      background: linear-gradient(90deg, #2563eb, #22c55e);
    }

    .hq-issue-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 4px;
      font-size: 11px;
    }

    .hq-issue-table th,
    .hq-issue-table td {
      border-bottom: 1px solid #e5e7eb;
      padding: 4px 6px;
      text-align: left;
      white-space: nowrap;
    }

    .hq-issue-table th {
      background: #eff6ff;
      color: #1d4ed8;
      font-weight: 600;
      border-bottom: 1px solid #bfdbfe;
    }

    .hq-issue-table tr:nth-child(even) td {
      background: #f9fafb;
    }

    /* í˜„ì¥ ëŒ€ì‹œë³´ë“œ (map2.jpg) */
    .site-dashboard {
      max-width: 1180px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1.6fr 1.2fr;
      gap: 16px;
      height: calc(100vh - 140px);
      max-height: 560px;
    }

    .site-map-card {
      border-radius: 18px;
      overflow: hidden;
      box-shadow: 0 16px 45px rgba(15, 23, 42, 0.16);
      border: 1px solid #d4d4d8;
      background: #0b1120;
      position: relative;
    }

    .site-map-bg {
      position: absolute;
      inset: 0;
      background-image: url("map2.jpg");
      background-size: cover;
      background-position: center;
      filter: saturate(1.05);
    }

    .site-map-overlay {
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.25), transparent 55%);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 10px 14px 12px;
      color: #f9fafb;
    }

    .site-map-header {
      font-size: 13px;
    }

    .site-map-title {
      font-size: 15px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .site-map-sub {
      font-size: 11px;
      opacity: 0.9;
    }

    .site-map-footer {
      font-size: 11px;
      display: flex;
      justify-content: space-between;
    }

    .site-map-badge {
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(191, 219, 254, 0.9);
      background: rgba(15, 23, 42, 0.7);
      font-size: 10px;
    }

    .site-right-card {
      border-radius: 18px;
      background: #ffffff;
      box-shadow: 0 16px 45px rgba(15, 23, 42, 0.12);
      border: 1px solid #e5e7eb;
      padding: 10px 12px 12px;
      display: flex;
      flex-direction: column;
      font-size: 12px;
    }

    .site-right-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 6px;
    }

    .site-title-main {
      font-size: 14px;
      font-weight: 700;
      color: #111827;
    }

    .site-title-sub {
      font-size: 11px;
      color: #6b7280;
    }

    .site-back-btn {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid #d4d4d8;
      background: #f3f4f6;
      color: #374151;
      cursor: pointer;
    }

    .site-info-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 4px;
      font-size: 11px;
    }

    .site-info-table th,
    .site-info-table td {
      border: 1px solid #e5e7eb;
      padding: 3px 6px;
      text-align: left;
      white-space: nowrap;
    }

    .site-info-table th {
      background: #f3f4f6;
      width: 80px;
      color: #4b5563;
    }

    .site-section-title {
      margin-top: 8px;
      font-size: 11px;
      font-weight: 600;
      color: #111827;
    }

    .site-main-work-box {
      margin-top: 4px;
      border-radius: 10px;
      border: 1px solid #fee2e2;
      background: #fef2f2;
      padding: 6px 8px;
      font-size: 11px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .site-main-work-label {
      color: #b91c1c;
      font-weight: 600;
    }

    .site-main-work-value {
      font-weight: 600;
      color: #7f1d1d;
    }

    /* ì‘ì—…/ì•ˆì „ì¼ë³´ ì „ì²´ ëª¨ë‹¬ (ë‘ ë²ˆì§¸ ì´ë¯¸ì§€ ë ˆì´ì•„ì›ƒ) */
    .daily-modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 28;
    }

    .daily-window {
      width: 1180px;
      max-width: 96vw;
      height: 660px;
      max-height: 92vh;
      background: #ffffff;
      border-radius: 10px;
      box-shadow: 0 30px 90px rgba(15, 23, 42, 0.95);
      display: flex;
      flex-direction: column;
      position: relative;
      overflow: hidden;
      border: 1px solid #cbd5e1;
    }

    .daily-header-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 14px;
      border-bottom: 1px solid #d4d4d8;
      background: linear-gradient(to bottom, #f4f4f5, #e5e7eb);
      font-size: 13px;
    }

    .daily-header-title {
      font-weight: 700;
    }

    .daily-header-close {
      font-size: 18px;
      cursor: pointer;
    }

    .daily-body {
      flex: 1;
      display: grid;
      grid-template-columns: 1.7fr 1.1fr;
      border-top: 1px solid #e5e7eb;
      font-size: 12px;
    }

    .daily-left {
      border-right: 1px solid #e5e7eb;
      display: flex;
      flex-direction: column;
    }

    .daily-left-top {
      padding: 6px 10px;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      align-items: center;
      gap: 8px;
      background: #f9fafb;
    }

    .daily-left-main {
      flex: 1;
      overflow: auto;
    }

    .daily-table {
      width: 100%;
      border-collapse: collapse;
    }

    .daily-table th,
    .daily-table td {
      border-bottom: 1px solid #e5e7eb;
      padding: 4px 6px;
      text-align: left;
      white-space: nowrap;
    }

    .daily-table th {
      background: #f3f4f6;
    }

    .daily-right {
      display: flex;
      flex-direction: column;
    }

    .daily-right-section {
      padding: 4px 6px;
      border-bottom: 1px solid #e5e7eb;
    }

    .daily-right-section textarea {
      width: 100%;
      min-height: 40px;
      resize: none;
      border: 1px solid #d4d4d8;
      font-size: 11px;
      font-family: inherit;
      box-sizing: border-box;
    }

    .daily-right-label {
      font-size: 11px;
      margin-bottom: 2px;
    }

    .daily-attend-row {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      margin-top: 4px;
    }

    .daily-attend-button {
      padding: 3px 8px;
      border-radius: 4px;
      border: 1px solid #9ca3af;
      background: #e5e7eb;
      cursor: pointer;
      font-size: 11px;
    }

    /* ì‘ì—…ì ì„ íƒ íŒì—… (ì²« ë²ˆì§¸ ì´ë¯¸ì§€ ë ˆì´ì•„ì›ƒ) */
    .worker-modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 30;
    }

    .worker-window {
      width: 880px;
      max-width: 96vw;
      height: 520px;
      max-height: 90vh;
      background: #ffffff;
      border-radius: 6px;
      box-shadow: 0 26px 80px rgba(15, 23, 42, 0.95);
      display: flex;
      flex-direction: column;
      position: relative;
      border: 1px solid #cbd5e1;
    }

    .worker-header {
      display: flex;
      justify-content: flex-end;
      padding: 4px 8px;
    }

    .worker-close {
      font-size: 20px;
      cursor: pointer;
    }

    .worker-table-wrap {
      flex: 1;
      padding: 0 8px 6px;
      overflow: auto;
    }

    .worker-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }

    .worker-table th,
    .worker-table td {
      border: 1px solid #d4d4d8;
      padding: 4px 6px;
      text-align: left;
      white-space: nowrap;
    }

    .worker-table th {
      background: #e5e7eb;
    }

    .worker-footer {
      padding: 8px;
      display: flex;
      justify-content: center;
      gap: 8px;
      border-top: 1px solid #d4d4d8;
      background: #f9fafb;
    }

    .worker-footer-btn {
      min-width: 80px;
      padding: 4px 10px;
      border-radius: 4px;
      border: 1px solid #111827;
      background: #1f2937;
      color: #f9fafb;
      cursor: pointer;
      font-size: 12px;
    }

    .worker-footer-btn.secondary {
      border-color: #4b5563;
      background: #e5e7eb;
      color: #111827;
    }

    .worker-checkbox {
      display: flex;
      justify-content: center;
    }

    @media (max-width: 960px) {
      .app-root {
        flex-direction: column;
      }
      .sidebar {
        flex-direction: row;
        width: 100%;
        height: auto;
        overflow-x: auto;
      }
      .sidebar-header,
      .sidebar-footer,
      .sidebar-section-title {
        display: none;
      }
      .main {
        height: calc(100vh - 72px);
      }
    }

    /* ê³ ì • í‘¸í„° (ì €ì‘ê¶Œ ì •ë³´) */
    .copyright-footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #0f172a;
      color: #ffffff;
      text-align: center;
      padding: 12px 16px;
      font-size: 13px;
      font-weight: 500;
      z-index: 10000;
      border-top: 2px solid #2563eb;
      box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.3);
    }

    .copyright-footer a {
      color: #60a5fa;
      text-decoration: none;
    }

    .copyright-footer a:hover {
      text-decoration: underline;
    }

    /* ë¡œê·¸ì¸ í™”ë©´ì—ì„œëŠ” í‘¸í„° ìˆ¨ê¹€ */
    .login-overlay ~ .copyright-footer {
      display: none;
    }
  </style>
</head>
<body>
  <!-- ë¡œê·¸ì¸ í™”ë©´ -->
  <div class="login-overlay" id="loginOverlay">
    <div class="login-card">
      <img src="logo.png" alt="BESMA logo" class="login-watermark" onerror="this.style.display='none';">
      <div class="login-inner">
        <div class="login-logo">
          <img src="onlylogo.png" alt="BESMA logo" class="login-logo-img" onerror="this.style.display='none';">
          <div>
            <div class="login-title-main">BESMA</div>
            <div class="login-title-sub">Boohyun Electric Safety Management App</div>
          </div>
        </div>
        <div class="login-heading">ì•ˆì „ë³´ê±´ í†µí•© ê´€ì œ ì‹œìŠ¤í…œ</div>
        <div class="login-desc">ë°ëª¨ í™˜ê²½ì…ë‹ˆë‹¤. ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ì— ì–´ë–¤ ê°’ì„ ë„£ì–´ë„ ë¡œê·¸ì¸ë©ë‹ˆë‹¤.</div>
        <form id="loginForm" onsubmit="event.preventDefault(); document.getElementById('loginOverlay').style.display='none'; return false;">
          <div class="field">
            <label for="userId">ì•„ì´ë””</label>
            <input id="userId" autocomplete="off" />
          </div>
          <div class="field">
            <label for="userPw">ë¹„ë°€ë²ˆí˜¸</label>
            <input id="userPw" type="password" autocomplete="off" />
          </div>
          <div class="login-hint">
            ì˜ˆì‹œ: <code>admin / 1234</code> (ì„ì˜ ê°’ í—ˆìš©, ì‹¤ì œ ì¸ì¦Â·API ì—†ìŒ)
          </div>
          <button type="submit" class="login-button" id="loginButton">ë¡œê·¸ì¸</button>
        </form>
        <div class="login-meta">
          <span>Virtual Login</span>
          <span>v0.1 Â· Prototype</span>
        </div>
      </div>
    </div>
  </div>

  <div class="app-root">
    <!-- ì‚¬ì´ë“œë°” (PDF ìˆœì„œ ê¸°ë°˜ 1~10 ë©”ë‰´) -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-title-main">BESMA</div>
        <div class="sidebar-title-sub">Boohyun Electric Safety Management App</div>
      </div>

      <div class="sidebar-section-title">ë©”ë‰´</div>
      <ul class="menu-list">
        <li class="menu-item" data-view="menu1">
          <div class="menu-item-icon">â‘ </div>
          <span>1. ëŒ€ì‹œë³´ë“œ</span>
        </li>
        <li class="menu-item" data-view="menu2">
          <div class="menu-item-icon">â‘¡</div>
          <span>2. ì•ˆì „ë³´ê±´ ë°©ì¹¨, ëª©í‘œ</span>
        </li>
        <li class="menu-item" data-view="menu3">
          <div class="menu-item-icon">â‘¢</div>
          <span>3. ì•ˆì „ ì„œë¥˜ ì—…ë¡œë“œ</span>
        </li>
        <li class="menu-item" data-view="menu4">
          <div class="menu-item-icon">â‘£</div>
          <span>4. ê³µì§€ ì‚¬í•­</span>
        </li>
        <li class="menu-item" data-view="menu5">
          <div class="menu-item-icon">â‘¤</div>
          <span>5. í†µê³„/ë¶„ì„ (ì˜ˆì •)</span>
        </li>
        <li class="menu-item" data-view="menu6">
          <div class="menu-item-icon">â‘¥</div>
          <span>6. ë¹„ìƒëŒ€ì‘</span>
        </li>
        <li class="menu-item" data-view="menu7">
          <div class="menu-item-icon">â‘¦</div>
          <span>7. ì‚¬ê³ ë³´ê³  / ê°œì„ </span>
        </li>
        <li class="menu-item" data-view="menu8">
          <div class="menu-item-icon">â‘§</div>
          <span>8. ìœ„í—˜ì„± í‰ê°€ D/B</span>
        </li>
        <li class="menu-item" data-view="menu9">
          <div class="menu-item-icon">â‘¨</div>
          <span>9. ì˜ê²¬ì²­ì·¨ í˜„í™© / ê°œì„ </span>
        </li>
        <li class="menu-item active" data-view="workorders">
          <div class="menu-item-icon">â‘©</div>
          <span>10. ì‘ì—…ì§€ì‹œ í˜„í™©</span>
        </li>
      </ul>

      <div class="sidebar-footer">
        <div><strong>Made by Jung Sangik</strong></div>
        <small>System Architecture & Logic Designed by Jung Sangik | Â© 2025 All Rights Reserved.</small>
      </div>
    </aside>

    <main class="main">
      <header class="topbar">
        <div class="topbar-left">
          <div class="topbar-title" id="topbarTitle">ì‘ì—…ì§€ì‹œ í˜„í™© (Work Order &amp; TBM)</div>
          <div class="topbar-sub" id="topbarSub">
            TBM ëŒ€ê¸° ìƒíƒœì˜ ì‘ì—…ì„ ëª¨ë°”ì¼ë¡œ ì—´ì–´ ìœ„í—˜ìš”ì¸ í™•ì¸ ë° ì„œëª… ì ˆì°¨ë¥¼ ì‹œë®¬ë ˆì´ì…˜í•©ë‹ˆë‹¤.
          </div>
        </div>
        <div class="topbar-right">
          <span class="pill-soft">ê°€ìƒ ë°ì´í„° Â· Frontend Only</span>
          <img src="onlylogo.png" alt="BESMA logo" class="global-logo-small" onerror="this.style.display='none';">
          <div class="avatar">B</div>
        </div>
      </header>

      <!-- ê³ ì • ê³µì§€ì‚¬í•­ ì˜ì—­ -->
      <div class="notice-bar" id="noticeBarClickable">
        <div class="notice-icon">ğŸ“¢</div>
        <div class="notice-text">ê³µì§€ì‚¬í•­ : BESMA ì•ˆì „ë³´ê±´í”Œë«í¼ ë² íƒ€ì„œë¹„ìŠ¤ ì˜ˆì • / 1ì›” 22ì¼ ì•ˆì „ë³´ê±´ê²½ì˜ë°©ì¹¨ ì„ í¬ì‹, ì•ˆì „ë³´ê±´ ìµœìš°ìˆ˜Â·ìš°ìˆ˜ìƒ í¬ìƒ ì˜ˆì •</div>
      </div>

      <!-- ëª¨ë“  í˜ì´ì§€ ê³µí†µ íƒ€ì„ë¼ì¸ -->
      <div class="timeline-bar">
        <div class="timeline-inner">
          <span>ë‚ ì”¨ : ì¸ì²œ 1êµ¬ì—­  - íë¦¼ / 27â„ƒ (ê°•í’ì£¼ì˜ë³´ Â· íƒ€ì›Œí¬ë ˆì¸ ì‘ì—… ì£¼ì˜)</span>
          <span>í˜„ì¥ ì ê²€ ìŠ¤ì¼€ì¤„ : ì˜¤ëŠ˜ 14:00 ì¸ì²œ 1êµ¬ì—­ ì •ê¸°ì ê²€ Â· 16:00 êµ¬ë¦¬ ì¸ì°½Cêµ¬ì—­ íŠ¹ë³„ì ê²€ ì˜ˆì •</span>
          <span>ì‹¤ì‹œê°„ NEWS : ì²œì•ˆ ë…¸íƒœê³µì› í˜„ì¥, ì›ì²­ì‚¬ ì•ˆì „ê´€ë¦¬ ìš°ìˆ˜ìƒ ìˆ˜ìƒ</span>
        </div>
      </div>

      <section class="main-content">
        <!-- ë‹¤ë¥¸ ë©”ë‰´ëŠ” ë‹¨ìˆœ í”Œë ˆì´ìŠ¤í™€ë” -->
        <div class="view" id="view-menu1">
          <div class="hq-dashboard">
            <!-- ì™¼ìª½: ì „êµ­ ì§€ë„ (map1.jpg) -->
            <div class="hq-map-card">
              <div class="hq-map-bg"></div>
              <div class="hq-map-overlay">
                <div class="hq-map-header">
                  <div>
                    <div class="hq-map-title">ì „êµ­ í˜„ì¥ ì§€ë„ (ë³¸ì‚¬ ê´€ì œ)</div>
                    <span>ì „êµ­ í˜„ì¥ ë¶„í¬ ë° ìœ„í—˜ë„, ì‹ ê·œ/ì¤€ê³µ í˜„ì¥ í‘œì‹œ</span>
                  </div>
                  <span class="hq-map-badge">map1.jpg Â· ìƒ˜í”Œ</span>
                </div>
                <div class="hq-map-footer">
                  <div class="hq-kpi-row">
                    <div class="hq-kpi-pill">
                      <span class="hq-kpi-label">ê°ì‹œ ì¤‘ í˜„ì¥</span>
                      <span class="hq-kpi-value">124ê°œì†Œ</span>
                    </div>
                    <div class="hq-kpi-pill">
                      <span class="hq-kpi-label">ìœ„í—˜êµ¬ì—­ ë“±ë¡</span>
                      <span class="hq-kpi-value">7ê°œ</span>
                    </div>
                    <div class="hq-kpi-pill">
                      <span class="hq-kpi-label">ì‹ ê·œ í˜„ì¥</span>
                      <span class="hq-kpi-value">3ê°œ</span>
                    </div>
                    <div class="hq-kpi-pill">
                      <span class="hq-kpi-label">ì¤€ê³µ ì„ë°•</span>
                      <span class="hq-kpi-value">5ê°œ</span>
                    </div>
                  </div>
                </div>
              </div>
              <div class="hq-map-click-layer" id="hqMapClick" title="ì§€ë„ ì•„ë¬´ ê³³ì´ë‚˜ í´ë¦­í•˜ë©´ í˜„ì¥ ëŒ€ì‹œë³´ë“œë¡œ ì´ë™"></div>
            </div>

            <!-- ì˜¤ë¥¸ìª½: KPI + ì´ìŠˆ í…Œì´ë¸” -->
            <div class="hq-right-card">
              <div class="hq-right-header">
                <div>
                  <div class="hq-right-title">ë³¸ì‚¬ ëŒ€ì‹œë³´ë“œ ìš”ì•½</div>
                  <div class="hq-right-sub">ë¬´ì¬í•´ ì¼ìˆ˜, ì¶œì—­ì¸ì›, ê³µì •ë¥ , ì—…ë¡œë“œ í˜„í™© ë“± í•µì‹¬ ì§€í‘œ</div>
                </div>
              </div>

              <div class="hq-stat-grid">
                <div class="hq-stat-card">
                  <div class="hq-stat-label">ì „ì‚¬ ë¬´ì¬í•´ ì¼ìˆ˜</div>
                  <div class="hq-stat-value">128 ì¼</div>
                  <div class="hq-stat-desc">ëª©í‘œ 365ì¼ / ì „ì¼ ëŒ€ë¹„ â–²1ì¼</div>
                </div>
                <div class="hq-stat-card">
                  <div class="hq-stat-label">ê¸ˆì¼ ì¶œì—­ì¸ì›</div>
                  <div class="hq-stat-value">1,247 ëª…</div>
                  <div class="hq-stat-desc">ì „ì¼ ëŒ€ë¹„ â–²38ëª… (ì‹ ê·œ 12ëª… í¬í•¨)</div>
                </div>
                <div class="hq-stat-card">
                  <div class="hq-stat-label">ì „ì‚¬ ê³µì •ë¥  í‰ê· </div>
                  <div class="hq-stat-value">63.4 %</div>
                  <div class="hq-bar-track">
                    <div class="hq-bar-fill" style="width:63.4%;"></div>
                  </div>
                  <div class="hq-stat-desc">ì§€ì—° í˜„ì¥ 4ê°œ / ahead í˜„ì¥ 3ê°œ</div>
                </div>
                <div class="hq-stat-card">
                  <div class="hq-stat-label">ê¸ˆì¼ ì—…ë¡œë“œ í˜„í™©</div>
                  <div class="hq-stat-value">92 %</div>
                  <div class="hq-bar-track">
                    <div class="hq-bar-fill" style="width:92%;background:linear-gradient(90deg,#22c55e,#16a34a);"></div>
                  </div>
                  <div class="hq-stat-desc">ë¯¸ì—…ë¡œë“œ í˜„ì¥ 9ê°œ (ìš°ì¸¡ í‘œ ì°¸ì¡°)</div>
                </div>
              </div>

              <div style="margin-top:6px;font-size:11px;color:#6b7280;">
                í˜„ì¥ ë³„ ì—…ë¡œë“œ ë¯¸ë¹„ í˜„í™© / ì‘ì—…ì¤‘ì§€ê¶ŒÂ·ìœ„í—˜ìš”ì¸ì‹ ê³  / ì‹ ê·œ í˜„ì¥ (ìƒ˜í”Œ ë°ì´í„°)
              </div>
              <table class="hq-issue-table">
                <thead>
                  <tr>
                    <th>í˜„ì¥ ë³„ ì—…ë¡œë“œ ë¯¸ë¹„ í˜„í™©</th>
                    <th>ì‘ì—…ì¤‘ì§€ê¶Œ Â· ìœ„í—˜ìš”ì¸ì‹ ê³ </th>
                    <th>ì‹ ê·œ í˜„ì¥</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>ê°€ë‚˜ë‹¤ í˜„ì¥ (TBM ì—…ë¡œë“œ ë¯¸ë¹„)</td>
                    <td>ê°€ë‚˜ë‹¤ í˜„ì¥ Â· ì‘ì—…ì¤‘ì§€ê¶Œ í–‰ì‚¬ 3ê±´</td>
                    <td>ê°€ë‚˜ë‹¤ í˜„ì¥ (25/12/21)</td>
                  </tr>
                  <tr>
                    <td>ë¼ë§ˆë°” í˜„ì¥ (ì‚¬ì§„ì²¨ë¶€ ëˆ„ë½)</td>
                    <td>ë¼ë§ˆë°” í˜„ì¥ Â· ìœ„í—˜ìš”ì¸ì‹ ê³  2ê±´</td>
                    <td>ë¼ë§ˆë°” í˜„ì¥ (26/01/02)</td>
                  </tr>
                  <tr>
                    <td>ì‚¬ì•„ì í˜„ì¥ (ì ê²€ê²°ê³¼ ë¯¸ë“±ë¡)</td>
                    <td>ì‚¬ì•„ì í˜„ì¥ Â· ìœ„í—˜ìš”ì¸ì‹ ê³  1ê±´</td>
                    <td>ì‚¬ì•„ì í˜„ì¥ (26/01/07)</td>
                  </tr>
                  <tr>
                    <td>ì°¨ì¹´íƒ€ í˜„ì¥ (êµìœ¡ì´ìˆ˜ ë¯¸ì—…ë¡œë“œ)</td>
                    <td>ì°¨ì¹´íƒ€ í˜„ì¥ Â· ì‘ì—…ì¤‘ì§€ê¶Œ 1ê±´</td>
                    <td>ì¤€ê³µ ì„ë°• í˜„ì¥ ë‹¤ìˆ˜</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- í˜„ì¥ ëŒ€ì‹œë³´ë“œ (map2.jpg) -->
        <div class="view" id="view-site">
          <div class="site-dashboard">
            <div class="site-map-card">
              <div class="site-map-bg"></div>
              <div class="site-map-overlay">
                <!-- ì§€ë„ ìœ„ í…ìŠ¤íŠ¸ëŠ” ì œê±°í•˜ê³ , ë°°ê²½ íš¨ê³¼ë§Œ ìœ ì§€ -->
              </div>
            </div>
            <div class="site-right-card">
              <div class="site-right-header">
                <div>
                  <div class="site-title-main">í˜„ì¥ ìƒì„¸ ì •ë³´</div>
                  <div class="site-title-sub">[1. ì•ˆì „ê±´ì„¤] ì¸ì²œ 1êµ¬ì—­ ì£¼íƒì¬ê°œë°œ ì •ë¹„ì‚¬ì—… ì‹ ì¶•</div>
                </div>
                <button class="site-back-btn" id="siteBackBtn">ë³¸ì‚¬ ëŒ€ì‹œë³´ë“œ</button>
              </div>
              <table class="site-info-table">
                <tbody>
                  <tr>
                    <th>í˜„ì¥ì½”ë“œ</th>
                    <td>22031</td>
                  </tr>
                  <tr>
                    <th>ê³µì‚¬</th>
                    <td>ì „ê¸°ê³µì‚¬</td>
                  </tr>
                  <tr>
                    <th>ê³µì‚¬ê¸°ê°„</th>
                    <td>2022-03-24 ~ 2024-11-30</td>
                  </tr>
                  <tr>
                    <th>ë°œì£¼ì²˜/ë„ê¸‰ê¸ˆì•¡</th>
                    <td>ì¸ì²œ1êµ¬ì—­ì¬ê°œë°œì¡°í•© / 67ì–µ (ì¶”ì •)</td>
                  </tr>
                  <tr>
                    <th>ì†Œì¥</th>
                    <td>í™ê¸¸ë™ Â· 010-1111-1111</td>
                  </tr>
                  <tr>
                    <th>ì•ˆì „ë‹´ë‹¹</th>
                    <td>ê¹€ì•ˆì „ Â· 010-2222-2222</td>
                  </tr>
                  <tr>
                    <th>ê´€ë¦¬ë‹´ë‹¹</th>
                    <td>ë°•ê´€ë¦¬ Â· 010-5555-5555</td>
                  </tr>
                </tbody>
              </table>

              <div class="site-section-title">ì£¼ìš” ì‘ì—… í˜„í™© (ì˜¤ëŠ˜)</div>
              <div class="site-main-work-box">
                <div>
                  <div class="site-main-work-label">ì¤‘ì ìœ„í—˜ì‘ì—…</div>
                  <div>102ë™ 2ì½”ì–´ ë™ë ¥ê°„ì„  ì‘ì—… (ì¼€ì´ë¸” í¬ì„¤ Â· ì¤‘ëŸ‰ë¬¼ ì·¨ê¸‰ Â· ê°œêµ¬ë¶€ ì¸ì ‘)</div>
                </div>
                <div class="site-main-work-value">í˜„ì¥ ì˜ê²¬ì²­ì·¨ ê´€ë¦¬ëŒ€ì¥ ë°”ë¡œê°€ê¸°</div>
              </div>

              <div class="site-section-title">ì‘ì—…ì§€ì‹œ / ìœ„í—˜ì„±í‰ê°€ / ì‚¬ê³ Â·ì ê²€ ìš”ì•½</div>
              <table class="site-info-table" style="margin-top:4px;">
                <tbody>
                  <tr>
                    <th>ì‘ì—…ì§€ì‹œ</th>
                    <td>ê°œì¸ë³„ìœ„í—˜ì„±í‰ê°€ í™•ì¸ (ë‹¤ë¥¸ ìœ„í—˜ìš”ì¸ ì‹ ê³  4ê±´)</td>
                  </tr>
                  <tr>
                    <th>ìœ„í—˜ì„±í‰ê°€</th>
                    <td>ì¤‘ì ìœ„í—˜ì‘ì—… 1ê±´, ì¼ë°˜ ì‘ì—… 5ê±´ í‰ê°€ ì™„ë£Œ</td>
                  </tr>
                  <tr>
                    <th>ì‚¬ê³  ì´ë ¥</th>
                    <td>0ê±´ (ìµœê·¼ 30ì¼)</td>
                  </tr>
                  <tr>
                    <th>ë³¸ì‚¬ ì ê²€</th>
                    <td>ì§€ì  2ê±´, ì‹œì •ì¡°ì¹˜ ì™„ë£Œ 2ê±´</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <div class="view" id="view-menu2">
          <div class="card"><p class="placeholder-text">2. ì•ˆì „ë³´ê±´ ë°©ì¹¨, ëª©í‘œ í™”ë©´ ì˜ˆì‹œ ì˜ì—­ì…ë‹ˆë‹¤.</p></div>
        </div>
        <div class="view" id="view-menu3">
          <div class="card"><p class="placeholder-text">3. ì•ˆì „ ì„œë¥˜ ì—…ë¡œë“œ í™”ë©´ ì˜ˆì‹œ ì˜ì—­ì…ë‹ˆë‹¤.</p></div>
        </div>
        <div class="view" id="view-menu4">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">ê³µì§€ ì‚¬í•­</div>
                <div class="card-sub">ì¤‘ìš” ê³µì§€ì‚¬í•­ì„ í™•ì¸í•˜ì„¸ìš”.</div>
              </div>
              <span class="chip">Menu 4</span>
            </div>
            <div class="notice-board">
              <div class="notice-item" data-id="1">
                <div class="notice-item-header">
                  <div class="notice-item-title">BESMA ì•ˆì „ë³´ê±´í”Œë«í¼ ë² íƒ€ì„œë¹„ìŠ¤ ì˜ˆì •</div>
                  <div class="notice-item-badge">ì¤‘ìš”</div>
                </div>
                <div class="notice-item-date">2026-01-20</div>
                <div class="notice-item-content">
                  BESMA ì•ˆì „ë³´ê±´í”Œë«í¼ì˜ ë² íƒ€ì„œë¹„ìŠ¤ê°€ ê³§ ì‹œì‘ë©ë‹ˆë‹¤. ëª¨ë“  í˜„ì¥ì—ì„œ ì•ˆì „ë³´ê±´ ê´€ë¦¬ ì—…ë¬´ë¥¼ ë””ì§€í„¸í™”í•˜ì—¬ íš¨ìœ¨ì„±ì„ ë†’ì´ê³ , ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ë° ìœ„í—˜ìš”ì¸ ê´€ë¦¬ë¥¼ ì§€ì›í•©ë‹ˆë‹¤.
                </div>
              </div>
              <div class="notice-item" data-id="2">
                <div class="notice-item-header">
                  <div class="notice-item-title">1ì›” 22ì¼ ì•ˆì „ë³´ê±´ê²½ì˜ë°©ì¹¨ ì„ í¬ì‹, ì•ˆì „ë³´ê±´ ìµœìš°ìˆ˜Â·ìš°ìˆ˜ìƒ í¬ìƒ ì˜ˆì •</div>
                  <div class="notice-item-badge">ì¤‘ìš”</div>
                </div>
                <div class="notice-item-date">2026-01-18</div>
                <div class="notice-item-content">
                  2026ë…„ 1ì›” 22ì¼ ë³¸ì‚¬ì—ì„œ ì•ˆì „ë³´ê±´ê²½ì˜ë°©ì¹¨ ì„ í¬ì‹ì´ ê°œìµœë©ë‹ˆë‹¤. ì´ë‚  ì•ˆì „ë³´ê±´ ìµœìš°ìˆ˜ í˜„ì¥ ë° ìš°ìˆ˜ í˜„ì¥ì— ëŒ€í•œ í¬ìƒì´ ì˜ˆì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë§ì€ ê´€ì‹¬ê³¼ ì°¸ì—¬ ë¶€íƒë“œë¦½ë‹ˆë‹¤.
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="view" id="view-menu5">
          <div class="card"><p class="placeholder-text">5. ëŒ€ì‹œë³´ë“œ í™”ë©´ ì˜ˆì‹œ ì˜ì—­ì…ë‹ˆë‹¤.</p></div>
        </div>
        <div class="view" id="view-menu6">
          <div class="card"><p class="placeholder-text">6. ë¹„ìƒëŒ€ì‘ í™”ë©´ ì˜ˆì‹œ ì˜ì—­ì…ë‹ˆë‹¤.</p></div>
        </div>
        <div class="view" id="view-menu7">
          <div class="card"><p class="placeholder-text">7. ì‚¬ê³ ë³´ê³  / ê°œì„  í™”ë©´ ì˜ˆì‹œ ì˜ì—­ì…ë‹ˆë‹¤.</p></div>
        </div>
        <div class="view" id="view-menu8">
          <div class="table-wrapper card">
            <div class="card-header">
              <div>
                <div class="card-title">ìœ„í—˜ì„± í‰ê°€ D/B (ì „ê¸°ê³µì‚¬ ì˜ˆì‹œ)</div>
                <div class="card-sub">ì‘ì—…ìœ í˜•ë³„ ëŒ€í‘œ ìœ„í—˜ìš”ì¸ì„ ì •ë¦¬í•œ ìƒ˜í”Œ ë°ì´í„°ì…ë‹ˆë‹¤. ì‘ì—…ì§€ì‹œ í™”ë©´ê³¼ ì—°ë™ë©ë‹ˆë‹¤.</div>
              </div>
              <span class="chip">Menu 8</span>
            </div>
            <table>
              <thead>
                <tr>
                  <th>ì‘ì—…ìœ í˜•</th>
                  <th>ì£¼ìš” ìœ„í—˜ìš”ì¸</th>
                </tr>
              </thead>
              <tbody id="riskDbTableBody"></tbody>
            </table>
          </div>
        </div>
        <div class="view" id="view-menu9">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">1ì›” ì˜ê²¬ ì²­ì·¨ ì„ ì • í‰ê°€í‘œ</div>
                <div class="card-sub">í˜„ì¥ì—ì„œ 1ì°¨ í‰ê°€ í›„, ë³¸ì‚¬ 2Â·3ì°¨ í‰ê°€ë¥¼ ì§„í–‰í•˜ëŠ” ì˜ˆì‹œ í™”ë©´ì…ë‹ˆë‹¤.</div>
              </div>
              <span class="chip">Menu 9</span>
            </div>
            <div class="table-wrapper" style="max-width:none;margin:0;">
              <table>
                <thead>
                  <tr>
                    <th style="width:40px;">NO</th>
                    <th>ìœ„í—˜ ìš”ì¸</th>
                    <th style="width:70px;">ì„±ëª…</th>
                    <th style="width:80px;">í‰ê°€ì</th>
                    <th style="width:90px;">ìœ„í—˜ì„±ì¸ì‹ìˆ˜ì¤€<br />(1Â·3Â·5ì )</th>
                    <th style="width:80px;">êµ¬ì²´ì„±<br />(1Â·5ì )</th>
                    <th style="width:90px;">ëª…í™•ì„±<br />(1Â·3Â·5ì )</th>
                    <th style="width:100px;">ì‹¤í˜„ê°€ëŠ¥ì„±<br />(1Â·3Â·5ì )</th>
                    <th style="width:60px;">ì´ì </th>
                    <th style="width:70px;">ê²°ê³¼(í‰ê· )</th>
                  </tr>
                </thead>
                <tbody id="opinionTableBody">
                  <!-- JSì—ì„œ mockData ê¸°ë°˜ìœ¼ë¡œ ë Œë”ë§ -->
                </tbody>
              </table>
            </div>
            <div style="display:flex;justify-content:flex-end;margin-top:10px;gap:8px;">
              <button class="status-badge" id="opinionDraftBtn" style="background:#e5e7eb;color:#111827;">ì„ì‹œ ì €ì¥</button>
              <button class="status-badge" id="opinionSubmitBtn" style="background:#16a34a;color:#ecfdf5;">ìƒì‹ </button>
            </div>
          </div>
        </div>

        <!-- 10. ì‘ì—…ì§€ì‹œ í˜„í™© + TBM -->
        <div class="view active" id="view-workorders">
            <div class="table-wrapper card">
              <div class="card-header">
                <div>
                  <div class="card-title">ì‘ì—…ì§€ì‹œ í˜„í™© (Work Orders)</div>
                  <div class="card-sub">ì‘ì—…ëª…ì„ ì…ë ¥/ì„ íƒí•˜ë©´ ì˜¤ë¥¸ìª½ì— í•´ë‹¹ ì‘ì—…ì˜ ìœ„í—˜ìš”ì¸Â·ëŒ€ì±…ì´ ìë™ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.</div>
                </div>
                <div style="display:flex;align-items:center;gap:8px;">
                  <button class="status-badge" id="mobilePreviewBtn" style="background:#e0f2fe;color:#1d4ed8;">ê·¼ë¡œì ì•±</button>
                  <button class="status-badge" id="resetWorkOrdersBtn" style="background:#e5e7eb;color:#111827;">ì´ˆê¸°í™”</button>
                  <span class="chip">Menu 10</span>
                </div>
              </div>
              <!-- ìœ„í—˜ì„±í‰ê°€ DB ì†ŒìŠ¤ ì„ íƒ ì»¨íŠ¸ë¡¤ ë°” -->
              <div class="db-source-control-bar">
                <label class="db-source-label">ìœ„í—˜ì„±í‰ê°€ DB ì†ŒìŠ¤ ì„ íƒ:</label>
                <select id="dbSourceSelect" class="db-source-select">
                  <option value="default" selected>[ê¸°ë³¸] ë¶€í˜„ì „ê¸° í‘œì¤€ ì „ê¸°ê³µì‚¬ DB (Active)</option>
                  <option value="client">[ì˜µì…˜] ë°œì£¼ì²˜(ì‚¼ì„±/í˜„ëŒ€) ì§€ì • DB</option>
                  <option value="custom">[ì‚¬ìš©ì] í˜„ì¥ ì§ì ‘ ì…ë ¥ ëª¨ë“œ</option>
                </select>
                <span class="db-source-badge" id="dbSourceBadge">ê¸°ë³¸ DB í™œì„±</span>
              </div>
              <div id="workOrderTableContainer"></div>
            </div>
        </div>
      </section>
    </main>
  </div>

  <!-- ì‘ì—…/ì•ˆì „ì¼ë³´ ì „ì²´ ëª¨ë‹¬ -->
  <div class="daily-modal-overlay" id="dailyModal">
    <div class="daily-window">
      <div class="daily-header-bar">
        <div class="daily-header-title" id="dailyHeaderTitle"></div>
        <div class="daily-header-close" id="dailyCloseBtn">âœ•</div>
      </div>
      <div class="daily-body">
        <div class="daily-left">
          <div class="daily-left-top">
            <div id="dailyDateLabel"></div>
            <div id="dailySiteLabel"></div>
          </div>
          <div class="daily-left-main">
            <table class="daily-table" id="dailyTaskTable"></table>
          </div>
        </div>
        <div class="daily-right" id="dailyRightPanel">
          <!-- ë‚´ìš©ì€ JSì—ì„œ mockData ê¸°ë°˜ìœ¼ë¡œ ì±„ì›€ -->
        </div>
      </div>
    </div>
  </div>

  <!-- ì‘ì—…ì ì„ íƒ íŒì—… -->
  <div class="worker-modal-overlay" id="workerModal">
    <div class="worker-window">
      <div class="worker-header">
        <div class="worker-close" id="workerCloseBtn">âœ•</div>
      </div>
      <div class="worker-table-wrap">
        <table class="worker-table" id="workerTable"></table>
      </div>
      <div class="worker-footer">
        <button class="worker-footer-btn secondary" id="copyPrevWorkBtn">ì „ë‚ ì‘ì—…ë³µì‚¬í•˜ê¸°</button>
        <button class="worker-footer-btn secondary" id="selectTeamBtn">íŒ€ì›ì„ íƒ</button>
        <button class="worker-footer-btn" id="workerConfirmBtn">í™• ì¸</button>
      </div>
    </div>
  </div>

  <!-- ê·¼ë¡œì ì•± í™ˆ ë¯¸ë¦¬ë³´ê¸° ì˜¤ë²„ë ˆì´ -->
  <div class="modal-overlay" id="mobileHomeOverlay" style="display:none;z-index:26;">
    <div class="modal-phone">
      <div class="modal-close-x" id="mobileHomeClose">âœ•</div>
      <div class="modal-phone-notch"></div>
      <div class="modal-phone-inner" style="gap:10px;">
        <div style="display:flex;justify-content:space-between;align-items:center;font-size:10px;color:#e5e7eb;">
          <img src="onlylogo.png" alt="BESMA logo" style="width:24px;height:24px;object-fit:contain;" onerror="this.style.display='none';">
          <span>MY Â· ë¡œê·¸ì•„ì›ƒ</span>
        </div>
        <div style="display:flex;gap:4px;font-size:9px;color:#e5e7eb;align-items:center;">
          <span>2024.05.20(ì›”)</span>
          <span>Â· 24â„ƒ</span>
          <span>Â· ë°˜í¬ 2ê³µêµ¬</span>
        </div>

        <div style="display:grid;gap:6px;">
          <button id="mobileStopBtn" style="border:none;border-radius:12px;background:#dc2626;color:#fee2e2;padding:18px 10px;font-size:18px;font-weight:700;box-shadow:0 8px 24px rgba(220,38,38,0.8);cursor:pointer;text-align:left;">
            ì‘ì—… ì¤‘ì§€<br /><span style="font-size:11px;font-weight:500;">ìœ„í—˜ ê°ì§€ ì‹œ ì¦‰ì‹œ í„°ì¹˜</span>
          </button>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;">
            <button style="border:none;border-radius:12px;background:#f97316;color:#111827;padding:10px 8px;font-size:12px;font-weight:600;cursor:pointer;text-align:left;">
              ìœ„í—˜ìš”ì¸ ì‹ ê³ <br /><span style="font-size:10px;font-weight:500;">(ì¹´ë©”ë¼ ì´¬ì˜)</span>
            </button>
            <button style="border:none;border-radius:12px;background:#eab308;color:#111827;padding:10px 8px;font-size:12px;font-weight:600;cursor:pointer;text-align:left;">
              ì‚¬ê³  / ë¹„ìƒ<br /><span style="font-size:10px;font-weight:500;">ì¦‰ì‹œ ì‹ ê³ </span>
            </button>
          </div>
        </div>

        <div style="margin-top:4px;">
          <div style="font-size:10px;color:#9ca3af;margin-bottom:4px;">Work ì¹´ë“œ</div>
          <button id="mobileOpenWorkBtn" style="width:100%;border:none;border-radius:12px;background:#020617;padding:10px;display:flex;flex-direction:column;align-items:flex-start;gap:4px;cursor:pointer;">
            <div style="font-size:11px;color:#e5e7eb;">ë²ˆí˜¸ 2ê³µêµ¬</div>
            <div style="font-size:10px;color:#9ca3af;">ìœ„ì¹˜: 103ë™ ì§€í•˜ 2ì¸µ</div>
            <div style="display:flex;gap:6px;font-size:9px;">
              <span style="padding:2px 6px;border-radius:999px;background:#1e293b;color:#e5e7eb;">3íšŒ ë™ì‹œ</span>
              <span style="padding:2px 6px;border-radius:999px;background:#f97316;color:#111827;">ì‹ ì²­ì¤‘</span>
            </div>
          </button>
          <button id="mobileFinishBtn" style="margin-top:6px;width:100%;border:none;border-radius:999px;background:#4b5563;color:#e5e7eb;padding:8px 0;font-size:11px;cursor:default;">
            ì‘ì—… í™•ì¸ (ì„œëª… í›„ ì‘ì—… ì¢…ë£Œ ë²„íŠ¼ìœ¼ë¡œ ì „í™˜)
          </button>
        </div>

        <div style="margin-top:12px;display:flex;justify-content:space-around;font-size:10px;color:#9ca3af;padding-top:8px;border-top:1px solid #111827;">
          <span>í™ˆ</span>
          <span>ì‘ì—…</span>
          <span>ì„œëª…</span>
          <span>ë¡œê·¸ì•„ì›ƒ</span>
        </div>
      </div>
    </div>
  </div>

  <!-- ì‘ì—… ì¢…ë£Œ í™•ì¸ ëª¨ë‹¬ (ê·¼ë¡œì ì•±ìš©) -->
  <div class="modal-overlay" id="mobileStopModal" style="display:none;z-index:28;">
    <div class="modal-phone" style="max-width:340px;height:auto;">
      <div class="modal-close-x" id="mobileStopClose">âœ•</div>
      <div class="modal-phone-notch"></div>
      <div class="modal-phone-inner" style="gap:10px;">
        <div class="modal-section-title">ê·¼ë¡œì¤‘ ì‚¬ê³  ë“± íŠ¹ì´ì‚¬í•­ì´ ì—†ì—ˆëŠ”ê°€?</div>
        <div class="modal-box" id="mobileStopStepQuestion">
          <div style="font-size:11px;color:#e5e7eb;margin-bottom:8px;">
            ì˜¤ëŠ˜ ì‘ì—… ì¤‘ ì‚¬ê³ , ì•„ì°¨ì‚¬ê³ , ì¥ë¹„ ì´ìƒ ë“± íŠ¹ì´ì‚¬í•­ì´ ìˆì—ˆëŠ”ì§€ ì„ íƒí•´ ì£¼ì„¸ìš”.
          </div>
          <div style="display:flex;gap:8px;">
            <button id="mobileStopYesBtn" class="modal-question-btn primary" style="flex:1;">ì˜ˆ (ì—†ìŒ)</button>
            <button id="mobileStopNoBtn" class="modal-question-btn" style="flex:1;">ì•„ë‹ˆì˜¤ (ìˆìŒ)</button>
          </div>
        </div>

        <div class="modal-box" id="mobileStopStepYes" style="display:none;flex-direction:column;gap:6px;">
          <div style="font-size:11px;color:#e5e7eb;">ë¬´ì‚¬ê³ ì¼ì§€ ì‘ì„±ì„ ìœ„í•´ ì„œëª…ì„ ë‚¨ê²¨ì£¼ì„¸ìš”.</div>
          <input id="mobileStopSignInput" placeholder="ì„œëª… (ì´ë¦„ ê¸°ì…)" style="width:100%;border-radius:8px;border:1px solid #4b5563;background:#020617;color:#e5e7eb;font-size:11px;padding:6px 8px;" />
          <button id="mobileStopYesSave" class="modal-sign-button" style="margin-top:4px;">ì €ì¥ ë° ì „ì†¡</button>
        </div>

        <div class="modal-box" id="mobileStopStepNo" style="display:none;flex-direction:column;gap:6px;">
          <div style="font-size:11px;color:#e5e7eb;">ê·¼ë¡œ ì¤‘ ë°œìƒí•œ íŠ¹ì´ì‚¬í•­ì„ ê°„ë‹¨íˆ ì…ë ¥í•´ ì£¼ì„¸ìš”.</div>
          <textarea id="mobileStopIssueInput" style="width:100%;min-height:60px;border-radius:8px;border:1px solid #4b5563;background:#020617;color:#e5e7eb;font-size:11px;padding:6px 8px;resize:vertical;" placeholder="ì˜ˆ) 102ë™ 2ì½”ì–´ ìì¬ë°˜ì¶œ ì‹œ ì§€ê²Œì°¨ ë™ì„  ê°„ì„­ìœ¼ë¡œ ì¼ì‹œ ì‘ì—… ì¤‘ì§€ í›„ ì •ë¦¬"></textarea>
          <button id="mobileStopNoSave" class="modal-extra-save-btn" style="align-self:flex-end;">ì €ì¥</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ëª¨ë°”ì¼ TBM ëª¨ë‹¬ -->
  <div class="modal-overlay" id="tbmModal">
    <div class="modal-phone">
      <div class="modal-close-x" id="modalCloseX">âœ•</div>
      <div class="modal-phone-notch"></div>
      <div class="modal-phone-inner">
        <div class="modal-header">
          <div class="modal-header-title">ì‘ì—…ì§€ì‹œ / ê°œì¸ìœ„í—˜ì„±í‰ê°€</div>
          <div style="font-size:10px;color:#9ca3af;">Demo Â· Offline</div>
        </div>

        <!-- ì‘ì—… ì •ë³´ -->
        <div class="modal-section-title">ì‘ì—… ì •ë³´</div>
        <div class="modal-box">
          <div class="modal-task-main" id="modalTaskName"></div>
          <div id="modalTaskMeta"></div>
        </div>

        <!-- í˜„ì¥ ìœ„ì¹˜ (ì§€ë„ ì¼ë¶€) -->
        <div class="modal-section-title">í˜„ì¥ ìœ„ì¹˜</div>
        <div class="modal-box" style="padding:6px 6px 8px;">
          <div class="modal-location-map">
            <div class="modal-location-label">ì¸ì²œ 1êµ¬ì—­ Â· 102ë™ 2ì½”ì–´</div>
          </div>
        </div>

        <!-- ìœ„í—˜ìš”ì¸ / ëŒ€ì±… ëª©ë¡ -->
        <div style="font-size:13px;font-weight:700;color:#e5e7eb;margin-bottom:6px;margin-top:4px;">ê°œì¸ë³„ ìœ„í—˜ì„±í‰ê°€</div>
        <div class="modal-section-title">ì£¼ìš” ìœ„í—˜ìš”ì¸</div>
        <div class="modal-box">
          <ul class="modal-risk-list" id="modalRiskList"></ul>
          <!-- Worker Feedback Input Section -->
          <div class="modal-feedback-section">
            <div class="modal-feedback-label">ì¶”ê°€ ìœ„í—˜ìš”ì¸ ë°œê²¬ ì‹œ ì…ë ¥ (ì„ íƒ)</div>
            <div class="modal-feedback-input-wrapper">
              <textarea id="modalWorkerFeedbackInput" class="modal-feedback-input" placeholder="ì¶”ê°€ë¡œ ë°œê²¬í•œ ìœ„í—˜ìš”ì¸ì„ ì…ë ¥í•˜ì„¸ìš” (ì„ íƒ)"></textarea>
              <button type="button" class="modal-feedback-voice-btn" id="modalFeedbackVoiceBtn" title="ìŒì„± ì…ë ¥">
                ğŸ¤
              </button>
            </div>
            <button type="button" class="modal-extra-save-btn" id="modalFeedbackSaveBtn" style="margin-top:8px;align-self:flex-end;">ì €ì¥</button>
          </div>
        </div>
        <div class="modal-section-title">ì£¼ìš” ëŒ€ì±…</div>
        <div class="modal-box">
          <ul class="modal-risk-list" id="modalMeasureList"></ul>
        </div>

        <!-- ì„œëª… ì˜ì—­ -->
        <div class="modal-section-title">ìœ„í—˜ìš”ì¸ í™•ì¸ ë° ì„œëª…</div>
        <div class="modal-box">
          <div class="modal-question-box" id="modalQuestionBox">
            <div>í˜„ì¬ ë“±ë¡ëœ ìœ„í—˜ìš”ì¸/ëŒ€ì±… ì™¸ì—, í˜„ì¥ì—ì„œ ëŠë¼ëŠ” ë‹¤ë¥¸ ìœ„í—˜ìš”ì¸ì´ ìˆìœ¼ë©´ ë§ì”€í•´ì£¼ì„¸ìš”.</div>
            <div class="modal-question-actions">
              <button class="modal-question-btn" id="modalOtherRiskBtn">ë‹¤ë¥¸ìœ„í—˜</button>
              <button class="modal-question-btn primary" id="modalConfirmRiskBtn">í™•ì¸</button>
            </div>
            <div class="modal-extra-risk-box" id="modalExtraRiskBox">
              <textarea id="modalExtraRiskInput" placeholder="ì˜ˆ) ìì¬ ì ì¬ ìœ„ì¹˜ê°€ í˜‘ì†Œí•˜ì—¬ ì§€ê²Œì°¨ ë™ì„  ê°„ì„­ ìš°ë ¤"></textarea>
              <button class="modal-extra-save-btn" id="modalExtraRiskSaveBtn">ì €ì¥ í›„ ì„œëª… ì§„í–‰</button>
            </div>
          </div>
          <div class="modal-sign-row">
            <div class="modal-worker-avatar">
              <img src="worker_face.jpg" alt="worker face" class="modal-worker-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
              <div class="modal-worker-placeholder">ğŸ‘·</div>
            </div>
            <div>
              <div class="modal-worker-name" id="modalWorkerName"></div>
              <div style="font-size:10px;color:#9ca3af;">TBM ì°¸ì—¬ ì‘ì—…ì</div>
            </div>
          </div>
          <div class="signature-area" id="signatureArea">
            <div class="signature-canvas-wrap">
              <canvas id="signatureCanvas"></canvas>
            </div>
            <div class="signature-actions">
              <span>ì†ê°€ë½ ë˜ëŠ” íœìœ¼ë¡œ ì„œëª…í•´ ì£¼ì„¸ìš”.</span>
              <button type="button" class="signature-clear-btn" id="signatureClearBtn">ì§€ìš°ê¸°</button>
            </div>
          </div>
          <button class="modal-sign-button" id="modalSignButton">
            ìœ„í—˜ìš”ì¸ í™•ì¸ ë° ì„œëª… (Sign)
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- AI ê²€í†  ëª¨ë‹¬ (ê´€ë¦¬ììš©) -->
  <div class="modal-overlay" id="aiReviewModal" style="display:none;z-index:30;">
    <div class="modal-phone" style="max-width:480px;height:auto;max-height:85vh;">
      <div class="modal-close-x" id="aiReviewClose">âœ•</div>
      <div class="modal-phone-notch"></div>
      <div class="modal-phone-inner" style="gap:12px;">
        <div class="modal-header">
          <div class="modal-header-title">ê·¼ë¡œì ì œë³´ ìœ„í—˜ìš”ì¸ ê²€í† </div>
          <div style="font-size:10px;color:#9ca3af;">AI ë¶„ì„ ì§€ì›</div>
        </div>

        <!-- ê·¼ë¡œì ì œë³´ ë‚´ìš© -->
        <div class="modal-section-title">ğŸ“ Worker Feedback</div>
        <div class="modal-box" id="aiReportedRisk">
          <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
        </div>

        <!-- AI ì¶”ì²œ ëŒ€ì±… -->
        <div class="modal-section-title">ğŸ¤– AI Recommended Action</div>
        <div class="modal-box" style="background:rgba(37,99,235,0.1);border:1px solid rgba(37,99,235,0.3);" id="aiSuggestedMeasure">
          <div style="color:#1e40af;font-weight:600;margin-bottom:6px;">AI ë¶„ì„ ê²°ê³¼:</div>
          <div id="aiAnalysisText" style="color:#1e3a8a;font-size:11px;line-height:1.5;margin-bottom:8px;">
            <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
          </div>
          <div style="color:#1e40af;font-weight:600;margin-top:8px;margin-bottom:4px;">[AI Recommended Action]:</div>
          <div id="aiMeasureText" style="color:#1e3a8a;font-size:11px;line-height:1.5;">
            <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
          </div>
        </div>

        <!-- ì•¡ì…˜ ë²„íŠ¼ -->
        <div style="display:flex;gap:8px;margin-top:4px;">
          <button class="modal-sign-button" id="aiAdoptBtn" style="flex:1;background:linear-gradient(135deg,#2563eb,#1e40af);">
            AI ëŒ€ì±… ì±„íƒ
          </button>
          <button class="modal-sign-button" id="aiSaveToDbBtn" style="flex:1;background:linear-gradient(135deg,#16a34a,#15803d);">
            Approve & Add to Corporate DB
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ----- ë¡œê·¸ì¸ ì²˜ë¦¬ (ê°€ìƒ) - ì—¬ëŸ¬ ë°©ë²•ìœ¼ë¡œ ì´ë²¤íŠ¸ ì—°ê²° -----
    function handleLogin() {
      const loginOverlay = document.getElementById("loginOverlay");
      if (loginOverlay) {
        loginOverlay.style.display = "none";
      }
      return false;
    }
    
    // DOMContentLoadedë¡œ ì—°ê²°
    document.addEventListener("DOMContentLoaded", function() {
      const loginForm = document.getElementById("loginForm");
      const loginButton = document.getElementById("loginButton");
      
      if (loginForm) {
        loginForm.addEventListener("submit", function (e) {
          e.preventDefault();
          handleLogin();
        });
      }
      
      if (loginButton) {
        loginButton.addEventListener("click", function (e) {
          e.preventDefault();
          handleLogin();
        });
      }
    });
    
    // ì¦‰ì‹œ ì‹¤í–‰ë„ ì‹œë„ (DOMì´ ì´ë¯¸ ë¡œë“œëœ ê²½ìš°)
    (function() {
      const loginForm = document.getElementById("loginForm");
      const loginButton = document.getElementById("loginButton");
      
      if (loginForm) {
        loginForm.addEventListener("submit", function (e) {
          e.preventDefault();
          handleLogin();
        });
      }
      
      if (loginButton) {
        loginButton.addEventListener("click", function (e) {
          e.preventDefault();
          handleLogin();
        });
      }
    })();

    // ----- ê°€ìƒ ë°ì´í„°: ëª¨ë“  ì‘ì—…ì§€ì‹œ / ìœ„í—˜ìš”ì¸ / ì¸ëª… / ì‘ì—…ì¼ë³´ í…ìŠ¤íŠ¸ëŠ” ì—¬ê¸°ì—ì„œë§Œ ìˆ˜ì • -----
    // ì‹¤ì œ ìš´ì˜ í™˜ê²½ì—ì„œëŠ” ì´ ë°ì´í„°ëŠ” APIë¥¼ í†µí•´ DBì—ì„œ ê°€ì ¸ì˜µë‹ˆë‹¤.
    // ì•„ë˜ êµ¬ì¡°ëŠ” "Platform + Data Consulting Service" ëª¨ë¸ì„ ì‹œì—°í•˜ê¸° ìœ„í•œ ìƒ˜í”Œì…ë‹ˆë‹¤.
    const mockData = {
      // ì‘ì—…ì§€ì‹œ ë°ì´í„° (API: GET /api/work-orders)
      workOrders: [
        {
          id: 1,
          date: "2026-01-23",
          team: "ì „ê¸° 1íŒ€",
          location: "102ë™ 2ì½”ì–´",
          task: "ë™ë ¥ê°„ì„  ì¼€ì´ë¸” í¬ì„¤ ì‘ì—…",
          risks: [
            "ì¤‘ëŸ‰ë¬¼ ìš´ë°˜ ì‹œ ì „ë„ ìœ„í—˜",
            "ì¼€ì´ë¸” ì ˆë‹¨ ì‹œ ì†ë² ì„ ì£¼ì˜",
            "ê°œêµ¬ë¶€ ì¶”ë½ ì£¼ì˜ (ì•ˆì „ê³ ë¦¬ ì²´ê²°)"
          ],
          measures: [
            "ë¦´Â·ë“œëŸ¼ ìš´ë°˜ ì‹œ 2ì¸ 1ì¡° ì‘ì—…, ì†ê°€ë½ ë¼ì„ì£¼ì˜ êµ¬í˜¸ TBM ì‹¤ì‹œ",
            "ì¼€ì´ë¸” ì»¤í„° ì „ìš© ê³µêµ¬ ì‚¬ìš©, ì ˆë‹¨ ë°©í–¥ í†µì œ ë° ì¥ê°‘ ì°©ìš©",
            "ê°œêµ¬ë¶€ ë®ê°œ ì„¤ì¹˜ ë° ì•ˆì „ë‚œê°„ ì„¤ì¹˜, ì•ˆì „ëŒ€ ê±¸ì´ í™•ë³´ í›„ ì‘ì—…"
          ],
          workerName: "ë°•ì„±êµ¬ ë°˜ì¥",
          statusWaiting: "TBM ëŒ€ê¸°",
          statusSigned: "ì„œëª… ì™„ë£Œ (Signed)"
        }
      ],
      // ìœ„í—˜ì„±í‰ê°€ ë°ì´í„°ë² ì´ìŠ¤ (API: GET /api/risk-database?source={default|client|custom})
      // ì´ ë°ì´í„°ëŠ” ì„ íƒëœ DB ì†ŒìŠ¤ì— ë”°ë¼ ë™ì ìœ¼ë¡œ ë³€ê²½ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      // - default: ë¶€í˜„ì „ê¸° í‘œì¤€ ì „ê¸°ê³µì‚¬ DB
      // - client: ë°œì£¼ì²˜(ì‚¼ì„±/í˜„ëŒ€) ì§€ì • DB
      // - custom: í˜„ì¥ ì§ì ‘ ì…ë ¥ ëª¨ë“œ (ì‚¬ìš©ìê°€ ì§ì ‘ ìœ„í—˜ìš”ì¸/ëŒ€ì±…ì„ ì…ë ¥)
      riskDb: [
        {
          id: 1,
          taskName: "ë™ë ¥ê°„ì„  ì¼€ì´ë¸” í¬ì„¤ ì‘ì—…",
          keyword: "ì¼€ì´ë¸” í¬ì„¤",
          risks: [
            "ì¼€ì´ë¸” ë¦´ ì¤‘ëŸ‰ë¬¼ ì·¨ê¸‰ ì¤‘ í—ˆë¦¬Â·ì†ê°€ë½ ë¼ì„",
            "ì¼€ì´ë¸” ì ˆë‹¨ ì‹œ ì¹¼ë‚ ì— ì˜í•œ ë² ì„",
            "íŠ¸ë ˆì´ ìƒë¶€ ì‘ì—… ì¤‘ ê°œêµ¬ë¶€ ë° ê°€ì¥ìë¦¬ ì¶”ë½"
          ],
          measures: [
            "ì¤‘ëŸ‰ë¬¼ ì·¨ê¸‰ ì‹œ 2ì¸ 1ì¡° ì‘ì—…, ì ì • ë¬´ê²Œ ë¶„ë‹´ ë° ìš´ë°˜ ê²½ë¡œ í™•ë³´",
            "ì ˆë‹¨ ì‘ì—… ì „ ì „ìš© ì¼€ì´ë¸” ì»¤í„° ì‚¬ìš©, ë³´í˜¸ì¥êµ¬(ì»·ë°©ì§€ ì¥ê°‘) ì°©ìš©",
            "ê°œêµ¬ë¶€ ë®ê°œÂ·ë‚œê°„ ì„¤ì¹˜, ì•ˆì „ë²¨íŠ¸ ê³ ë¦¬ ì²´ê²° í›„ ì‘ì—… ë° ì¶”ë½ ê¸ˆì§€êµ¬ì—­ ì„¤ì •"
          ]
        },
        {
          id: 2,
          taskName: "ë¶„ì „ë°˜ ì„¤ì¹˜ ë° ê²°ì„  ì‘ì—…",
          keyword: "ë¶„ì „ë°˜ ì„¤ì¹˜",
          risks: [
            "í†µì „ ìƒíƒœ ì˜¤ì¸ìœ¼ë¡œ ì¸í•œ ê°ì „ ìœ„í—˜",
            "ë¶„ì „ë°˜ ì´ë™Â·ì„¤ì¹˜ ì‹œ ì „ë„ ë° í˜‘ì°©",
            "ê²°ì„  ì‘ì—… ì¤‘ ë‚ ì¹´ë¡œìš´ ëª¨ì„œë¦¬ì— ì˜í•œ ì°°ê³¼ìƒ"
          ],
          measures: [
            "LOTO(ì ê¸ˆ/í‘œì‹œ) ì‹œí–‰, ë¹„í†µì „ í™•ì¸ í›„ ì‘ì—…, ì‘ì—… ì¤‘ ì¬í†µì „ ê¸ˆì§€",
            "ë¶„ì „ë°˜ ì´ë™ ì‹œ ì „ìš© ìš´ë°˜êµ¬ ì‚¬ìš©, ë„˜ì–´ì§ ë°©ì§€ìš© ë³´ì¡° ì¸ë ¥ ë°°ì¹˜",
            "ëª¨ì„œë¦¬ ë³´í˜¸ìº¡ ë¶€ì°©, ì ˆì—°ì¥ê°‘Â·ë³´ì•ˆê²½ ë“± ë³´í˜¸êµ¬ ì°©ìš©"
          ]
        },
        {
          id: 3,
          taskName: "ë°°ì„ ê´€ ë°°ê´€ ë° ì²œì¥ ë°•ìŠ¤ ì„¤ì¹˜",
          keyword: "ë°°ì„ ê´€ ë°°ê´€",
          risks: [
            "ë¹„ê³„Â·ì‚¬ë‹¤ë¦¬ ì‚¬ìš© ì¤‘ ë¯¸ë„ëŸ¬ì§ ë° ì¶”ë½",
            "í•´ë¨¸ ë“œë¦´ ì‚¬ìš© ì‹œ ë¹„ì‚°ë¬¼ì— ì˜í•œ ëˆˆ ë¶€ìƒ",
            "ì²œì¥ ìœ„ ì´ë™ ì¤‘ ê°œêµ¬ë¶€ ë¹ ì§ ì‚¬ê³ "
          ],
          measures: [
            "ì‚¬ë‹¤ë¦¬ ê°ë„Â·ì§€ì§€ ìƒíƒœ í™•ì¸, ì‘ì—…ë°œíŒ ë‚œê°„ ì„¤ì¹˜, ì´ë™ ì‹œ 3ì  ì§€ì§€ ìœ ì§€",
            "í•´ë¨¸ ë“œë¦´ ì‚¬ìš© ì‹œ ë³´ì•ˆê²½Â·ê·€ë§ˆê°œ ì°©ìš©, ë¹„ì‚°ë°©ì§€ë§‰ ì„¤ì¹˜",
            "ì²œì¥ ê°œêµ¬ë¶€ í‘œì‹œ ë° ë®ê°œ ì„¤ì¹˜, í†µë¡œ ì™¸ ì´ë™ ê¸ˆì§€"
          ]
        },
        {
          id: 4,
          taskName: "ì¡°ëª…ê¸°êµ¬ ì„¤ì¹˜ ë° ì² ê±°",
          keyword: "ì¡°ëª… ì„¤ì¹˜",
          risks: [
            "ì „ì› ì°¨ë‹¨ ë¯¸í¡ìœ¼ë¡œ ì¸í•œ ê°ì „ ìœ„í—˜",
            "ì‚¬ë‹¤ë¦¬ ìƒë¶€ì—ì„œì˜ ê³¼ë„í•œ ì‘ì—… ìì„¸ë¡œ ì¸í•œ ì „ë„",
            "íŒŒì†ëœ ì¡°ëª…ê¸°êµ¬ íŒŒí¸ì— ì˜í•œ ëˆˆÂ·ì† ë² ì„"
          ],
          measures: [
            "ì¡°ëª…íšŒë¡œ ì°¨ë‹¨ê¸° OFF ë° ë¬´ì „ì•• í™•ì¸ í›„ ì‘ì—…, ì‘ì—… ì¤‘ ì„ì˜ ë³µì „ ê¸ˆì§€",
            "ì‚¬ë‹¤ë¦¬ ìƒë‹¨ 2ë‹¨ ì´ë‚´ ì‘ì—…, ëª¸ ì¤‘ì‹¬ ì´íƒˆ ê¸ˆì§€, ë³´ì¡°ì ë°°ì¹˜",
            "ì¡°ëª… íƒˆì°© ì‹œ íŒŒì† ë°©ì§€ ì»¤ë²„ ì‚¬ìš©, ë³´ì•ˆê²½Â·ì»·ë°©ì§€ ì¥ê°‘ ì°©ìš©"
          ]
        },
        {
          id: 5,
          taskName: "ì˜¥ì™¸ ìˆ˜ì „ì„¤ë¹„ ì ê²€Â·ìœ ì§€ë³´ìˆ˜",
          keyword: "ìˆ˜ì „ì„¤ë¹„ ì ê²€",
          risks: [
            "ê³ ì•• ì„¤ë¹„ ì ‘ê·¼ ì¤‘ í™œì„  ë¶€ë¶„ ì ‘ì´‰ìœ¼ë¡œ ì¸í•œ ê°ì „",
            "ë¹„Â·ëˆˆ ë“± ì•…ì²œí›„ ì‹œ ë¯¸ë„ëŸ¬ì§ ë° ë‚™ìƒ",
            "í˜‘ì†Œí•œ í•¨ ë‚´ë¶€ ì‘ì—… ì¤‘ ì‚°ì†Œ ê²°í• ë° í˜‘ì°©"
          ],
          measures: [
            "í™œì„  ê±°ë¦¬ ìœ ì§€, ì ˆì—°ë´‰Â·ì ˆì—°ì¥ê°‘ ì‚¬ìš©, ì ‘ì§€ ìƒíƒœ í™•ì¸ í›„ ì‘ì—…",
            "ìš°ì²œÂ·ê²°ë¹™ ì‹œ ì‘ì—… ì¤‘ì§€ ë˜ëŠ” ë¯¸ë„ëŸ¼ ë°©ì§€ ì¡°ì¹˜ í›„ ì‘ì—…",
            "ê°œíê¸° í•¨ ë‚´ë¶€ ì‚°ì†Œ ë†ë„ ì¸¡ì •, í•„ìš” ì‹œ í™˜ê¸° í›„ 2ì¸ 1ì¡° ì‘ì—…"
          ]
        }
      ],
      // ì‘ì—…/ì•ˆì „ì¼ë³´ ë°ì´í„° (API: GET /api/work-log/{date})
      workLog: {
        headerTitle: "ì‘ì—…/ì•ˆì „ì¼ë³´",
        dateLabel: "2025ë…„ 12ì›” 22ì¼ (ê¸ˆ)",
        siteLabel: "[24018][1.DLê±´ì„¤] ì „ë„ê´€êµ¬ì—­ ì£¼íƒ",
        monthLabel: "2025ë…„ 12ì›”",
        tasks: [
          "í˜„ì¥ê´€ë¦¬ ë° ë„ë©´ê²€í† /ì„œë¥˜ì‘ì„±",
          "104ë™ ì§€í•˜1,2ì¸µ ì…ì„ ",
          "104ë™ 15ì¸µ ê²½ëŸ‰ë²½ì²´ ë°°ê´€",
          "105ë™ 16~18ì¸µ ì„¸ëŒ€ ì…ì„  ë° ê²°ì„ ",
          "105ë™ 23ì¸µ ìŠ¬ë¼ë¸Œ ë°°ê´€"
        ],
        educationPlace: "í˜„ì¥ íšŒì˜ì‹¤",
        educationTime: "ì˜¤ì „ 08:00 ~ 08:30",
        attendeeSummary: "ê¸°ì¡´ì¶œì—­ì 30ëª…, ì‹ ê·œì…ì‚¬ì 2ëª…, í•©ê³„ 32ëª…",
        safetyGuideLabel: "ì•ˆì „êµìœ¡ ë° ì§€ì‹œë‚´ìš©",
        safetyGuideText: "ì˜¤ëŠ˜ ì‘ì—… êµ¬ê°„ì˜ ë‚™í•˜Â·ì¶”ë½ ìœ„í—˜ìš”ì¸ê³¼ ê°ì „ ìœ„í—˜ì— ëŒ€í•´ êµìœ¡ ë° ì§€ì‹œ.",
        inspectionLabel: "ì•ˆì „ì ê²€(ìœ„í—˜ê°œì†Œ ì£¼ì˜ë‚´ìš©)",
        inspectionText: "ê°œêµ¬ë¶€ ë®ê°œ ìƒíƒœ ì ê²€, ê°€ì„¤ê³„ë‹¨ ì†ìŠ¤ì¹¨ ë‚œê°„ ìƒíƒœ í™•ì¸.",
        accidentLabel: "ì¬í•´ ë˜ëŠ” ì•ˆì „ì¡°ì¹˜ë‚´ìš©",
        accidentText: "ì¬í•´ ì—†ìŒ. ìœ„í—˜ìš”ì¸ ê´€ë ¨ ì¶”ê°€ ì¡°ì¹˜ ì‚¬í•­ ì—†ìŒ.",
        attendButtonLabel: "ì¶œì—­ì ì„ íƒ"
      },
      // ë¬´ì‚¬ê³ ì¼ì§€ ê¸°ë¡ (API: POST /api/safe-log) - ê·¼ë¡œì ì•± ì‘ì—…ì¢…ë£Œ ì‹œ ì €ì¥
      safeLog: [],
      // ê·¼ë¡œì ëª©ë¡ (API: GET /api/workers)
      workers: [
        { id: 1, name: "ê°•ë¯¼", reg: "880409-1", team: "ë°±ëŒ€ì§„", selected: false },
        { id: 2, name: "ê¹€ë™ì¬", reg: "930425-1", team: "ê°•ìœ¤ì² ", selected: false },
        { id: 3, name: "ê¹€ì˜¥ìˆ˜", reg: "690128-1", team: "ë°±ëŒ€ì§„", selected: true },
        { id: 4, name: "ë‚˜ì˜ˆë€", reg: "800812-2", team: "ê°•ìœ¤ì² ", selected: false },
        { id: 5, name: "ë°•ì„í˜¸", reg: "830601-1", team: "ë°•ì„í˜¸", selected: false },
        { id: 6, name: "ì‹¬ì˜ì„", reg: "750921-1", team: "ìœ ê°œì„ ", selected: true },
        { id: 7, name: "ìœ ë™ë¯¼", reg: "710711-1", team: "ë°±ëŒ€ì§„", selected: false },
        { id: 8, name: "ì´ìƒì—´", reg: "720902-1", team: "ë°±ëŒ€ì§„", selected: false },
        { id: 9, name: "ì¥ì§„ìš°", reg: "860701-1", team: "ìœ ê°œì„ ", selected: false },
        { id: 10, name: "ì¡°ë¬¸ì„ ", reg: "620426-1", team: "ì–‘ê¸¸ì„±", selected: false },
        { id: 11, name: "í•œì¼ìˆ˜", reg: "711030-1", team: "ì–‘ê¸¸ì„±", selected: false }
      ],
      // ì‹œìŠ¤í…œ ë©”íƒ€ë°ì´í„°
      version: "1.0.0",
      author: "Jung Sangik"
    };


    // ----- ë©”ë‰´ ì „í™˜ -----
    const viewMeta = {
      workorders: {
        title: "ì‘ì—…ì§€ì‹œ í˜„í™© (Work Order & TBM)",
        sub: "TBM ëŒ€ê¸° ìƒíƒœì˜ ì‘ì—…ì„ ëª¨ë°”ì¼ TBM í™”ë©´ìœ¼ë¡œ ì—´ì–´ ì„œëª… ì™„ë£Œê¹Œì§€ ì‹œë®¬ë ˆì´ì…˜í•©ë‹ˆë‹¤."
      },
      menu1: {
        title: "ë³¸ì‚¬ ëŒ€ì‹œë³´ë“œ",
        sub: "ì „êµ­ ì§€ë„(map1.jpg)ì™€ ì „ì‚¬ KPI, ì—…ë¡œë“œ/ì‹ ê³  í˜„í™©ì„ í•œëˆˆì— í™•ì¸í•©ë‹ˆë‹¤."
      },
      menu2: { title: "ì•ˆì „ë³´ê±´ ë°©ì¹¨, ëª©í‘œ", sub: "2. ì•ˆì „ë³´ê±´ ë°©ì¹¨, ëª©í‘œ í™”ë©´ ì˜ˆì‹œì…ë‹ˆë‹¤." },
      menu3: { title: "ì•ˆì „ ì„œë¥˜ ì—…ë¡œë“œ", sub: "3. ì•ˆì „ ì„œë¥˜ ì—…ë¡œë“œ í™”ë©´ ì˜ˆì‹œì…ë‹ˆë‹¤." },
      menu4: { title: "ê³µì§€ ì‚¬í•­", sub: "4. ê³µì§€ ì‚¬í•­ í™”ë©´ ì˜ˆì‹œì…ë‹ˆë‹¤." },
      menu5: { title: "í†µê³„/ë¶„ì„ (ì˜ˆì •)", sub: "5. í†µê³„/ë¶„ì„ í™”ë©´ì€ ì¶”í›„ ê³ ë„í™” ë‹¨ê³„ì—ì„œ êµ¬í˜„í•©ë‹ˆë‹¤." },
      menu6: { title: "ë¹„ìƒëŒ€ì‘", sub: "6. ë¹„ìƒëŒ€ì‘ í™”ë©´ ì˜ˆì‹œì…ë‹ˆë‹¤." },
      menu7: { title: "ì‚¬ê³ ë³´ê³  / ê°œì„ ", sub: "7. ì‚¬ê³ ë³´ê³  / ê°œì„  í™”ë©´ ì˜ˆì‹œì…ë‹ˆë‹¤." },
      menu8: { title: "ìœ„í—˜ì„± í‰ê°€ D/B", sub: "8. ìœ„í—˜ì„± í‰ê°€ D/B í™”ë©´ ì˜ˆì‹œì…ë‹ˆë‹¤." },
      menu9: { title: "ì˜ê²¬ì²­ì·¨ í˜„í™© / ê°œì„ ", sub: "9. ì˜ê²¬ì²­ì·¨ í˜„í™© / ê°œì„  í™”ë©´ ì˜ˆì‹œì…ë‹ˆë‹¤." }
    };

    function initMenuNavigation() {
      const menuItems = document.querySelectorAll(".menu-item");
      const views = document.querySelectorAll(".view");
      const topbarTitle = document.getElementById("topbarTitle");
      const topbarSub = document.getElementById("topbarSub");

      if (!menuItems.length || !views.length) {
        console.warn("ë©”ë‰´ í•­ëª© ë˜ëŠ” ë·°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        return;
      }

      function switchView(viewKey) {
        menuItems.forEach((item) => {
          if (item.getAttribute("data-view") === viewKey) {
            item.classList.add("active");
          } else {
            item.classList.remove("active");
          }
        });

        views.forEach((v) => {
          if (v.id === "view-" + viewKey) {
            v.classList.add("active");
          } else {
            v.classList.remove("active");
          }
        });

        const meta = viewMeta[viewKey];
        if (meta && topbarTitle && topbarSub) {
          topbarTitle.textContent = meta.title;
          topbarSub.textContent = meta.sub;
        }
      }

      menuItems.forEach((item) => {
        item.addEventListener("click", (e) => {
          e.preventDefault();
          e.stopPropagation();
          const key = item.getAttribute("data-view");
          if (key) {
            switchView(key);
          }
        });
      });

      // ìƒë‹¨ ê³µì§€ì‚¬í•­ ë°” í´ë¦­ ì‹œ ê³µì§€ì‚¬í•­ ë©”ë‰´ë¡œ ì´ë™
      const noticeBar = document.getElementById("noticeBarClickable");
      if (noticeBar) {
        noticeBar.addEventListener("click", () => {
          switchView("menu4");
        });
      }
    }

    // DOMContentLoadedë¡œ ë©”ë‰´ ì´ˆê¸°í™”
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", initMenuNavigation);
    } else {
      // DOMì´ ì´ë¯¸ ë¡œë“œëœ ê²½ìš° ì¦‰ì‹œ ì‹¤í–‰
      initMenuNavigation();
    }

    // ----- ì‘ì—…ì§€ì‹œ í…Œì´ë¸” ë Œë”ë§ -----
    const workOrderState = {}; // id -> { signed: boolean, feedback: string }

    function renderWorkOrderTable() {
      const container = document.getElementById("workOrderTableContainer");
      
      // ê·¼ë¡œìë³„ë¡œ ì‘ì—…ì§€ì‹œ í–‰ ìƒì„±
      // ê° ê·¼ë¡œìì—ê²Œ ì‘ì—…ì§€ì‹œë¥¼ í• ë‹¹ (ê°™ì€ ì‘ì—…ì§€ì‹œë¥¼ ì—¬ëŸ¬ ê·¼ë¡œìê°€ ë°›ì„ ìˆ˜ ìˆìŒ)
      const workerWorkOrders = [];
      
      mockData.workers.forEach((worker) => {
        // ê° ê·¼ë¡œìì—ê²Œ ì²« ë²ˆì§¸ ì‘ì—…ì§€ì‹œë¥¼ í• ë‹¹ (ì‹¤ì œë¡œëŠ” ì‘ì—…ì§€ì‹œ í• ë‹¹ ë¡œì§ì— ë”°ë¼ ë‹¬ë¼ì§)
        const wo = mockData.workOrders[0]; // ê¸°ë³¸ì ìœ¼ë¡œ ì²« ë²ˆì§¸ ì‘ì—…ì§€ì‹œ ì‚¬ìš©
        if (wo) {
          // ê·¼ë¡œìë³„ ê³ ìœ  ID ìƒì„± (workOrderId + workerId)
          const workerWorkOrderId = `${wo.id}_${worker.id}`;
          const state = workOrderState[workerWorkOrderId] || workOrderState[wo.id];
          const signed = state === true || (state && state.signed === true);
          const feedback = (state && typeof state === 'object' && state.feedback) ? state.feedback : null;
          const needsAIReview = (state && typeof state === 'object' && state.needsAIReview === true);
          const statusLabel = signed ? wo.statusSigned : wo.statusWaiting;
          const statusClass = signed ? "status-badge status-signed" : "status-badge status-wait";
          const btnAttr = signed ? 'data-signed="true"' : 'data-signed="false"';
          
          // ê·¼ë¡œì ì˜ê²¬ í‘œì‹œ (New Msg ì•„ì´ì½˜ ë˜ëŠ” "-")
          const feedbackCell = feedback 
            ? `<span class="feedback-icon" data-feedback="${feedback.replace(/"/g, '&quot;').replace(/'/g, '&#39;')}">ğŸ’¬ New Msg<div class="feedback-tooltip">${feedback}</div></span>`
            : "-";
          
          // AI ê²€í†  ì•Œë¦¼ ì•„ì´ì½˜ (í”¼ë“œë°±ì´ ìˆê³  AI ê²€í† ê°€ í•„ìš”í•œ ê²½ìš°)
          const aiAlertIcon = needsAIReview
            ? `<button class="ai-alert-icon" data-work-id="${workerWorkOrderId}" data-feedback-text="${feedback ? feedback.replace(/"/g, '&quot;').replace(/'/g, '&#39;') : ''}" title="ê·¼ë¡œì ì œë³´ ê²€í†  ë° AI ëŒ€ì±… ìˆ˜ë¦½">ğŸ”´ AI ê²€í† </button>`
            : "";
          
          workerWorkOrders.push({
            worker,
            wo,
            workerWorkOrderId,
            state,
            signed,
            feedback,
            needsAIReview,
            statusLabel,
            statusClass,
            btnAttr,
            feedbackCell,
            aiAlertIcon
          });
        }
      });
      
      const rowsHtml = workerWorkOrders
        .map(({ worker, wo, workerWorkOrderId, statusLabel, statusClass, btnAttr, feedbackCell, aiAlertIcon }) => {
          return `
            <tr>
              <td>${wo.date}</td>
              <td>${worker.team}<br><span style="font-size:10px;color:#6b7280;">${worker.name}</span></td>
              <td>${wo.location}</td>
              <td>
                <div style="position:relative;">
                  <input class="task-input" data-id="${workerWorkOrderId}" data-worker-id="${worker.id}" value="${wo.task}" placeholder="ì‘ì—…ëª…ì„ ì…ë ¥í•˜ë©´ ìœ„í—˜ì„±í‰ê°€ ê²€ìƒ‰" />
                  <div class="task-suggest-list" data-id="${workerWorkOrderId}"></div>
                </div>
                <button class="status-badge" data-id="${workerWorkOrderId}" data-daily="true" style="margin-top:4px;background:#e5e7eb;color:#111827;">
                  ì‘ì—…/ì•ˆì „ì¼ë³´
                </button>
              </td>
              <td style="font-size:11px;line-height:1.4;">
                <div style="color:#b91c1c;font-weight:600;">ìœ„í—˜ìš”ì¸</div>
                <div>${(wo.risks || []).join("<br>") || "-"}</div>
                <div style="margin-top:3px;color:#065f46;font-weight:600;">ëŒ€ì±…</div>
                <div>${(wo.measures || []).join("<br>") || "-"}</div>
              </td>
              <td>
                <div style="display:flex;align-items:center;gap:6px;">
                  <button class="${statusClass}" data-id="${workerWorkOrderId}" data-worker-id="${worker.id}" ${btnAttr}>
                    ${statusLabel}
                  </button>
                  ${aiAlertIcon}
                </div>
              </td>
              <td class="feedback-cell">${feedbackCell}</td>
            </tr>
          `;
        })
        .join("");

      container.innerHTML = `
        <table>
          <thead>
            <tr>
              <th>ë‚ ì§œ</th>
              <th>íŒ€ / ê·¼ë¡œì</th>
              <th>ìœ„ì¹˜</th>
              <th>ì‘ì—…</th>
              <th>ìœ„í—˜ìš”ì¸ / ëŒ€ì±…</th>
              <th>ìƒíƒœ</th>
              <th>ê·¼ë¡œì ì˜ê²¬</th>
            </tr>
          </thead>
          <tbody>
            ${rowsHtml}
          </tbody>
        </table>
      `;

      // ìƒíƒœ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
      container.querySelectorAll(".status-badge").forEach((btn) => {
        const id = btn.getAttribute("data-id"); // workerWorkOrderId (ë¬¸ìì—´)
        const workerId = btn.getAttribute("data-worker-id");
        const isSigned = btn.getAttribute("data-signed") === "true";
        const isDaily = btn.getAttribute("data-daily") === "true";
        if (isDaily) {
          btn.addEventListener("click", () => openDailyModal(id));
        } else if (!isSigned) {
          btn.addEventListener("click", () => openTbmModal(id, workerId));
        }
      });

      // ì‘ì—…ëª… ìë™ì™„ì„± í•¸ë“¤ëŸ¬ ë¶€ì°©
      attachTaskSuggestHandlers();

      // AI ê²€í†  ì•Œë¦¼ ì•„ì´ì½˜ í´ë¦­ ì´ë²¤íŠ¸
      container.querySelectorAll(".ai-alert-icon").forEach((btn) => {
        btn.addEventListener("click", () => {
          const workId = btn.getAttribute("data-work-id"); // workerWorkOrderId (ë¬¸ìì—´)
          const feedbackText = btn.getAttribute("data-feedback-text");
          if (workId && feedbackText) {
            openAIReviewModal(workId, feedbackText);
          }
        });
      });
    }

    // ----- TBM ëª¨ë‹¬ ì œì–´ -----
    const tbmModal = document.getElementById("tbmModal");
    const modalCloseX = document.getElementById("modalCloseX");
    const modalTaskName = document.getElementById("modalTaskName");
    const modalTaskMeta = document.getElementById("modalTaskMeta");
    const modalRiskList = document.getElementById("modalRiskList");
    const modalMeasureList = document.getElementById("modalMeasureList");
    const modalWorkerName = document.getElementById("modalWorkerName");
    const modalSignButton = document.getElementById("modalSignButton");
    const modalQuestionBox = document.getElementById("modalQuestionBox");
    const modalOtherRiskBtn = document.getElementById("modalOtherRiskBtn");
    const modalConfirmRiskBtn = document.getElementById("modalConfirmRiskBtn");
    const modalExtraRiskBox = document.getElementById("modalExtraRiskBox");
    const modalExtraRiskInput = document.getElementById("modalExtraRiskInput");
    const modalExtraRiskSaveBtn = document.getElementById("modalExtraRiskSaveBtn");
    const signatureArea = document.getElementById("signatureArea");
    const signatureCanvas = document.getElementById("signatureCanvas");
    const signatureClearBtn = document.getElementById("signatureClearBtn");

    let currentWorkOrderId = null;
    let tbmStep = "question"; // 'question' | 'sign'
    const extraRiskNotes = {}; // id -> string

    function enterQuestionPhase() {
      tbmStep = "question";
      if (modalQuestionBox) modalQuestionBox.style.display = "block";
      if (modalExtraRiskBox) modalExtraRiskBox.style.display = "none";
      if (modalSignButton) modalSignButton.style.display = "none";
      if (signatureArea) signatureArea.style.display = "none";
      if (modalExtraRiskInput) modalExtraRiskInput.value = "";
    }

    function enterSignPhase() {
      tbmStep = "sign";
      if (modalQuestionBox) modalQuestionBox.style.display = "none";
      if (modalSignButton) modalSignButton.style.display = "block";
      if (signatureArea) signatureArea.style.display = "flex";
      resizeSignatureCanvas();
    }

    function openTbmModal(workerWorkOrderId, workerId) {
      // workerWorkOrderId í˜•ì‹: "workOrderId_workerId"
      const parts = workerWorkOrderId.split("_");
      const workOrderId = Number(parts[0]);
      const actualWorkerId = workerId ? Number(workerId) : (parts[1] ? Number(parts[1]) : null);
      
      const wo = mockData.workOrders.find((w) => w.id === workOrderId);
      if (!wo) return;
      
      // ê·¼ë¡œì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
      const worker = actualWorkerId ? mockData.workers.find((w) => w.id === actualWorkerId) : null;
      const workerName = worker ? worker.name : wo.workerName;
      const teamName = worker ? worker.team : wo.team;
      
      currentWorkOrderId = workerWorkOrderId; // workerWorkOrderId ì‚¬ìš©

      modalTaskName.textContent = wo.task;
      modalTaskMeta.textContent = `${wo.date} Â· ${wo.location} Â· ${teamName}`;

      modalRiskList.innerHTML = wo.risks
        .map((r) => `<li>${r}</li>`)
        .join("");

      if (modalMeasureList) {
        modalMeasureList.innerHTML = (wo.measures || [])
          .map((m) => `<li>${m}</li>`)
          .join("");
      }

      modalWorkerName.textContent = workerName;

      enterQuestionPhase();
      tbmModal.style.display = "flex";
    }

    function closeTbmModal() {
      tbmModal.style.display = "none";
      currentWorkOrderId = null;
      enterQuestionPhase();
      // í”¼ë“œë°± ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
      const feedbackInput = document.getElementById("modalWorkerFeedbackInput");
      if (feedbackInput) {
        feedbackInput.value = "";
      }
    }

    function showToastMessage(message) {
      // ê¸°ì¡´ í† ìŠ¤íŠ¸ê°€ ìˆìœ¼ë©´ ì œê±°
      const existingToast = document.querySelector(".toast-message");
      if (existingToast) {
        existingToast.remove();
      }

      // ìƒˆ í† ìŠ¤íŠ¸ ìƒì„±
      const toast = document.createElement("div");
      toast.className = "toast-message";
      toast.textContent = message;
      document.body.appendChild(toast);

      // 3ì´ˆ í›„ ìë™ ì œê±°
      setTimeout(() => {
        if (toast.parentNode) {
          toast.remove();
        }
      }, 3000);
    }

    modalCloseX.addEventListener("click", closeTbmModal);
    tbmModal.addEventListener("click", (e) => {
      if (e.target === tbmModal) {
        closeTbmModal();
      }
    });

    function activateMobileFinishButton() {
      if (!mobileFinishBtn) return;
      mobileFinishEnabled = true;
      mobileFinishBtn.textContent = "ì‘ì—… ì¢…ë£Œ";
      mobileFinishBtn.style.background = "#16a34a";
      mobileFinishBtn.style.color = "#ecfdf5";
      mobileFinishBtn.style.cursor = "pointer";
    }

    // ë§ˆì´í¬ ë²„íŠ¼ ì´ë²¤íŠ¸ (ì‹œê°ì  í”¼ë“œë°±ë§Œ)
    const modalFeedbackVoiceBtn = document.getElementById("modalFeedbackVoiceBtn");
    if (modalFeedbackVoiceBtn) {
      modalFeedbackVoiceBtn.addEventListener("click", () => {
        // ì‹œê°ì  í”¼ë“œë°± (ìŒì„± ì…ë ¥ ê¸°ëŠ¥ì€ ë°ëª¨ì—ì„œëŠ” êµ¬í˜„í•˜ì§€ ì•ŠìŒ)
        modalFeedbackVoiceBtn.style.transform = "scale(0.9)";
        setTimeout(() => {
          modalFeedbackVoiceBtn.style.transform = "scale(1)";
        }, 150);
      });
    }

    // ì¶”ê°€ ìœ„í—˜ìš”ì¸ ì €ì¥ ë²„íŠ¼
    const modalFeedbackSaveBtn = document.getElementById("modalFeedbackSaveBtn");
    if (modalFeedbackSaveBtn) {
      modalFeedbackSaveBtn.addEventListener("click", () => {
        const feedbackInput = document.getElementById("modalWorkerFeedbackInput");
        if (feedbackInput && feedbackInput.value.trim().length > 0) {
          const feedbackText = feedbackInput.value.trim();
          // ì„ì‹œ ì €ì¥ (ì„œëª… ì‹œ ìµœì¢… ì €ì¥ë¨)
          if (currentWorkOrderId != null) {
            if (!workOrderState[currentWorkOrderId]) {
              workOrderState[currentWorkOrderId] = {};
            }
            workOrderState[currentWorkOrderId].feedback = feedbackText;
          }
          showToastMessage("âœ… ì¶”ê°€ ìœ„í—˜ìš”ì¸ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. ì„œëª… ì‹œ í•¨ê»˜ ì „ì†¡ë©ë‹ˆë‹¤.");
        } else {
          showToastMessage("âš ï¸ ì…ë ¥ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.");
        }
      });
    }

    modalSignButton.addEventListener("click", () => {
      // Worker Feedback Input í™•ì¸
      const feedbackInput = document.getElementById("modalWorkerFeedbackInput");
      const hasFeedback = feedbackInput && feedbackInput.value.trim().length > 0;

      // workOrderState ì—…ë°ì´íŠ¸ ë° mockDataì— ìœ„í—˜ìš”ì¸ ì¶”ê°€
      if (currentWorkOrderId != null) {
        // workerWorkOrderId í˜•ì‹: "workOrderId_workerId"
        const parts = currentWorkOrderId.split("_");
        const workOrderId = Number(parts[0]);
        const workerId = parts[1] ? Number(parts[1]) : null;
        
        const wo = mockData.workOrders.find(w => w.id === workOrderId);
        const worker = workerId ? mockData.workers.find(w => w.id === workerId) : null;
        
        if (hasFeedback) {
          const feedbackText = feedbackInput.value.trim();
          
          // mockData.workOrdersì˜ risks ë°°ì—´ì— ê·¼ë¡œì ì œë³´ ìœ„í—˜ìš”ì¸ ì¶”ê°€ (ê°œì¸ë³„ ìœ„í—˜ì„±í‰ê°€)
          if (wo) {
            if (!wo.risks) {
              wo.risks = [];
            }
            // ì¤‘ë³µ ì²´í¬ í›„ ì¶”ê°€ (íŒ€ì´ë¦„, ê·¼ë¡œìì´ë¦„ í¬í•¨)
            const teamName = worker ? worker.team : (wo.team || "ë¯¸ì§€ì •");
            const workerName = worker ? worker.name : (wo.workerName || "ë¯¸ì§€ì •");
            const workerReportedRisk = `[${teamName}, ${workerName}] ${feedbackText}`;
            if (!wo.risks.includes(workerReportedRisk)) {
              wo.risks.push(workerReportedRisk);
            }
          }
          
          // í”¼ë“œë°± ë°ì´í„°ë¥¼ workOrderStateì— ì €ì¥ (API ì „ì†¡ ì‹œë®¬ë ˆì´ì…˜)
          workOrderState[currentWorkOrderId] = {
            signed: true,
            feedback: feedbackText,
            needsAIReview: true // AI ê²€í†  í•„ìš” í”Œë˜ê·¸
          };
          // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ì™€ í•¨ê»˜ ì „ì†¡ ë©”ì‹œì§€ í‘œì‹œ
          showToastMessage("ğŸ“¡ Data Encrypted & Sent to Cloud API... ê´€ë¦¬ìì—ê²Œ ì „ë‹¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
        } else {
          // í”¼ë“œë°±ì´ ì—†ìœ¼ë©´ signedë§Œ trueë¡œ ì„¤ì •
          workOrderState[currentWorkOrderId] = true;
        }
        // í…Œì´ë¸” ì—…ë°ì´íŠ¸ (ìœ„í—˜ìš”ì¸/ëŒ€ì±… ë°˜ì˜)
        renderWorkOrderTable();
      }

      // í”¼ë“œë°±ì´ ìˆìœ¼ë©´ í† ìŠ¤íŠ¸ ë©”ì‹œì§€ê°€ ì‚¬ë¼ì§„ í›„ ëª¨ë‹¬ ë‹«ê¸°
      if (hasFeedback) {
        setTimeout(() => {
          closeTbmModal();
          activateMobileFinishButton();
        }, 3000);
      } else {
        closeTbmModal();
        // ê·¼ë¡œì ì•± í™ˆì—ì„œ ì‘ì—…ì§€ì‹œ ì„œëª…ì´ ì™„ë£Œë˜ë©´ 'ì‘ì—… ì¢…ë£Œ' ë²„íŠ¼ í™œì„±í™”
        activateMobileFinishButton();
      }
    });

    if (modalOtherRiskBtn) {
      modalOtherRiskBtn.addEventListener("click", () => {
        if (modalExtraRiskBox) modalExtraRiskBox.style.display = "flex";
      });
    }

    if (modalConfirmRiskBtn) {
      modalConfirmRiskBtn.addEventListener("click", () => {
        enterSignPhase();
      });
    }

    if (modalExtraRiskSaveBtn) {
      modalExtraRiskSaveBtn.addEventListener("click", () => {
        if (currentWorkOrderId != null && modalExtraRiskInput) {
          extraRiskNotes[currentWorkOrderId] = modalExtraRiskInput.value.trim();
        }
        enterSignPhase();
      });
    }

    // ----- ì„œëª… ìº”ë²„ìŠ¤ ê·¸ë¦¬ê¸° ë¡œì§ -----
    let isDrawing = false;
    let lastX = 0;
    let lastY = 0;
    let sigCtx = null;

    function resizeSignatureCanvas() {
      if (!signatureCanvas) return;
      const rect = signatureCanvas.getBoundingClientRect();
      const ratio = window.devicePixelRatio || 1;
      signatureCanvas.width = rect.width * ratio;
      signatureCanvas.height = rect.height * ratio;
      sigCtx = signatureCanvas.getContext("2d");
      sigCtx.scale(ratio, ratio);
      sigCtx.lineWidth = 2;
      sigCtx.lineCap = "round";
      sigCtx.strokeStyle = "#e5e7eb";
      sigCtx.clearRect(0, 0, rect.width, rect.height);
    }

    function startDraw(x, y) {
      if (!sigCtx) return;
      isDrawing = true;
      lastX = x;
      lastY = y;
    }

    function moveDraw(x, y) {
      if (!isDrawing || !sigCtx) return;
      sigCtx.beginPath();
      sigCtx.moveTo(lastX, lastY);
      sigCtx.lineTo(x, y);
      sigCtx.stroke();
      lastX = x;
      lastY = y;
    }

    function endDraw() {
      isDrawing = false;
    }

    if (signatureCanvas) {
      signatureCanvas.addEventListener("mousedown", (e) => {
        const rect = signatureCanvas.getBoundingClientRect();
        startDraw(e.clientX - rect.left, e.clientY - rect.top);
      });
      signatureCanvas.addEventListener("mousemove", (e) => {
        const rect = signatureCanvas.getBoundingClientRect();
        moveDraw(e.clientX - rect.left, e.clientY - rect.top);
      });
      window.addEventListener("mouseup", endDraw);

      signatureCanvas.addEventListener("touchstart", (e) => {
        e.preventDefault();
        const t = e.touches[0];
        const rect = signatureCanvas.getBoundingClientRect();
        startDraw(t.clientX - rect.left, t.clientY - rect.top);
      }, { passive: false });

      signatureCanvas.addEventListener("touchmove", (e) => {
        e.preventDefault();
        const t = e.touches[0];
        const rect = signatureCanvas.getBoundingClientRect();
        moveDraw(t.clientX - rect.left, t.clientY - rect.top);
      }, { passive: false });

      window.addEventListener("touchend", endDraw);
      window.addEventListener("touchcancel", endDraw);
    }

    if (signatureClearBtn) {
      signatureClearBtn.addEventListener("click", () => {
        if (!signatureCanvas || !sigCtx) return;
        const rect = signatureCanvas.getBoundingClientRect();
        sigCtx.clearRect(0, 0, rect.width, rect.height);
      });
    }

    window.addEventListener("resize", () => {
      if (tbmStep === "sign" && signatureArea && signatureArea.style.display !== "none") {
        resizeSignatureCanvas();
      }
    });

    // ----- ì‘ì—…/ì•ˆì „ì¼ë³´ ëª¨ë‹¬ ì œì–´ -----
    const dailyModal = document.getElementById("dailyModal");
    const dailyCloseBtn = document.getElementById("dailyCloseBtn");
    const dailyHeaderTitle = document.getElementById("dailyHeaderTitle");
    const dailyDateLabel = document.getElementById("dailyDateLabel");
    const dailySiteLabel = document.getElementById("dailySiteLabel");
    const dailyTaskTable = document.getElementById("dailyTaskTable");
    const dailyRightPanel = document.getElementById("dailyRightPanel");

    function openDailyModal(id) {
      const wl = mockData.workLog;
      dailyHeaderTitle.textContent = wl.headerTitle;
      dailyDateLabel.textContent = wl.dateLabel;
      dailySiteLabel.textContent = wl.siteLabel;

      // ì‘ì—… ëª©ë¡ í…Œì´ë¸”
      const taskRows = wl.tasks
        .map(
          (t, idx) => `
          <tr>
            <td style="width:40px;">${idx + 1}</td>
            <td>${t}</td>
          </tr>
        `
        )
        .join("");
      dailyTaskTable.innerHTML = `
        <thead>
          <tr>
            <th style="width:40px;">êµ¬ë¶„</th>
            <th>ì‘ì—…ë‚´ìš©</th>
          </tr>
        </thead>
        <tbody>
          ${taskRows}
        </tbody>
      `;

      // ì˜¤ë¥¸ìª½ íŒ¨ë„ êµ¬ì„±
      dailyRightPanel.innerHTML = `
        <div class="daily-right-section">
          <div class="daily-right-label">1. êµìœ¡ì¥ì†Œ</div>
          <input type="text" style="width:100%;font-size:11px;" value="${wl.educationPlace}" />
        </div>
        <div class="daily-right-section">
          <div class="daily-right-label">2. êµìœ¡ì‹œê°„</div>
          <input type="text" style="width:100%;font-size:11px;" value="${wl.educationTime}" />
        </div>
        <div class="daily-right-section">
          <div class="daily-right-label">3. ì°¸ì„ì (ì¶œì—­í˜„í™©)</div>
          <div class="daily-attend-row">
            <button class="daily-attend-button" id="openWorkerModalBtn">${wl.attendButtonLabel}</button>
            <span id="dailyAttendSummary">${wl.attendeeSummary}</span>
          </div>
        </div>
        <div class="daily-right-section">
          <div class="daily-right-label">5. ${wl.safetyGuideLabel}</div>
          <textarea>${wl.safetyGuideText}</textarea>
        </div>
        <div class="daily-right-section">
          <div class="daily-right-label">6. ${wl.inspectionLabel}</div>
          <textarea>${wl.inspectionText}</textarea>
        </div>
        <div class="daily-right-section" style="flex:1;">
          <div class="daily-right-label">7. ${wl.accidentLabel}</div>
          <textarea style="height:100%;">${wl.accidentText}</textarea>
        </div>
      `;

      const openWorkerBtn = document.getElementById("openWorkerModalBtn");
      if (openWorkerBtn) {
        openWorkerBtn.addEventListener("click", () => openWorkerModal());
      }

      dailyModal.style.display = "flex";
    }

    function closeDailyModal() {
      dailyModal.style.display = "none";
    }

    dailyCloseBtn.addEventListener("click", closeDailyModal);
    dailyModal.addEventListener("click", (e) => {
      if (e.target === dailyModal) closeDailyModal();
    });

    // ----- ì‘ì—…ì ì„ íƒ íŒì—… ì œì–´ -----
    const workerModal = document.getElementById("workerModal");
    const workerCloseBtn = document.getElementById("workerCloseBtn");
    const workerConfirmBtn = document.getElementById("workerConfirmBtn");
    const copyPrevWorkBtn = document.getElementById("copyPrevWorkBtn");
    const selectTeamBtn = document.getElementById("selectTeamBtn");
    const workerTable = document.getElementById("workerTable");

    function renderWorkerTable() {
      const rows = mockData.workers
        .map(
          (w) => `
        <tr>
          <td class="worker-checkbox">
            <input type="checkbox" data-worker-id="${w.id}" ${w.selected ? "checked" : ""} />
          </td>
          <td>${w.name}</td>
          <td>${w.reg}</td>
          <td>${w.team}</td>
        </tr>
      `
        )
        .join("");

      workerTable.innerHTML = `
        <thead>
          <tr>
            <th style="width:40px;text-align:center;">ì„ íƒ</th>
            <th>ì„±ëª…</th>
            <th>ì£¼ë¯¼ë²ˆí˜¸</th>
            <th>íŒ€ì¥</th>
          </tr>
        </thead>
        <tbody>
          ${rows}
        </tbody>
      `;
    }

    function openWorkerModal() {
      renderWorkerTable();
      workerModal.style.display = "flex";
    }

    function closeWorkerModal() {
      workerModal.style.display = "none";
    }

    workerCloseBtn.addEventListener("click", closeWorkerModal);
    workerModal.addEventListener("click", (e) => {
      if (e.target === workerModal) closeWorkerModal();
    });

    function autoSelectRoughlyTwelve() {
      const checkboxes = workerTable.querySelectorAll("input[type='checkbox']");
      let count = 0;
      checkboxes.forEach((cb) => {
        if (count < 12) {
          cb.checked = true;
          count += 1;
        } else {
          cb.checked = false;
        }
      });
    }

    if (copyPrevWorkBtn) {
      copyPrevWorkBtn.addEventListener("click", () => {
        autoSelectRoughlyTwelve();
      });
    }

    if (selectTeamBtn) {
      selectTeamBtn.addEventListener("click", () => {
        autoSelectRoughlyTwelve();
      });
    }

    workerConfirmBtn.addEventListener("click", () => {
      // ì²´í¬ ìƒíƒœë¥¼ mockDataì— ë°˜ì˜
      const checkboxes = workerTable.querySelectorAll("input[type='checkbox']");
      let count = 0;
      checkboxes.forEach((cb) => {
        const id = Number(cb.getAttribute("data-worker-id"));
        const worker = mockData.workers.find((w) => w.id === id);
        if (worker) {
          worker.selected = cb.checked;
          if (cb.checked) count += 1;
        }
      });

      const summaryEl = document.getElementById("dailyAttendSummary");
      if (summaryEl) {
        summaryEl.textContent = `${mockData.workLog.attendButtonLabel} ì„ íƒ ì¸ì›: ${count}ëª…`;
      }

      closeWorkerModal();
    });

    // ----- ê·¼ë¡œì ì•± í™ˆ ë¯¸ë¦¬ë³´ê¸° ì œì–´ -----
    const mobileHomeOverlay = document.getElementById("mobileHomeOverlay");
    const mobileHomeClose = document.getElementById("mobileHomeClose");
    const mobileOpenWorkBtn = document.getElementById("mobileOpenWorkBtn");
    const mobilePreviewBtn = document.getElementById("mobilePreviewBtn");
    const mobileStopBtnEl = document.getElementById("mobileStopBtn");
    const mobileStopModal = document.getElementById("mobileStopModal");
    const mobileStopClose = document.getElementById("mobileStopClose");
    const mobileStopYesBtn = document.getElementById("mobileStopYesBtn");
    const mobileStopNoBtn = document.getElementById("mobileStopNoBtn");
    const mobileStopStepQuestion = document.getElementById("mobileStopStepQuestion");
    const mobileStopStepYes = document.getElementById("mobileStopStepYes");
    const mobileStopStepNo = document.getElementById("mobileStopStepNo");
    const mobileStopSignInput = document.getElementById("mobileStopSignInput");
    const mobileStopIssueInput = document.getElementById("mobileStopIssueInput");
    const mobileStopYesSave = document.getElementById("mobileStopYesSave");
    const mobileStopNoSave = document.getElementById("mobileStopNoSave");
    const mobileFinishBtn = document.getElementById("mobileFinishBtn");

    let currentWorkStartTime = null;
    let mobileFinishEnabled = false;

    function openMobileHome() {
      if (mobileHomeOverlay) {
        mobileHomeOverlay.style.display = "flex";
        if (!currentWorkStartTime) {
          currentWorkStartTime = new Date();
        }
      }
    }

    function closeMobileHome() {
      if (mobileHomeOverlay) {
        mobileHomeOverlay.style.display = "none";
      }
    }

    if (mobilePreviewBtn) {
      mobilePreviewBtn.addEventListener("click", openMobileHome);
    }

    if (mobileHomeClose) {
      mobileHomeClose.addEventListener("click", closeMobileHome);
    }

    if (mobileHomeOverlay) {
      mobileHomeOverlay.addEventListener("click", (e) => {
        if (e.target === mobileHomeOverlay) {
          closeMobileHome();
        }
      });
    }

    if (mobileOpenWorkBtn) {
      mobileOpenWorkBtn.addEventListener("click", () => {
        // ê·¼ë¡œì ì•± í™ˆì—ì„œ Work ì¹´ë“œë¥¼ ëˆ„ë¥´ë©´ ì‘ì—…ì§€ì‹œ/ê°œì¸ìœ„í—˜ì„±í‰ê°€ í™”ë©´ìœ¼ë¡œ ì´ë™
        // ì²« ë²ˆì§¸ ê·¼ë¡œìì˜ ì²« ë²ˆì§¸ ì‘ì—…ì§€ì‹œ ì‚¬ìš© (ë°ëª¨)
        const firstWorker = mockData.workers[0];
        const firstWorkOrder = mockData.workOrders[0];
        if (firstWorker && firstWorkOrder) {
          const workerWorkOrderId = `${firstWorkOrder.id}_${firstWorker.id}`;
          openTbmModal(workerWorkOrderId, firstWorker.id);
        }
      });
    }

    function openMobileStopModal() {
      if (!mobileStopModal) return;
      mobileStopStepQuestion.style.display = "block";
      mobileStopStepYes.style.display = "none";
      mobileStopStepNo.style.display = "none";
      mobileStopModal.style.display = "flex";
    }

    function closeMobileStopModal() {
      if (!mobileStopModal) return;
      mobileStopModal.style.display = "none";
    }

    if (mobileStopBtnEl) {
      mobileStopBtnEl.addEventListener("click", () => {
        alert("ì‘ì—…ì¤‘ì§€ ìš”ì²­ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤. (í˜„ì¥ê´€ë¦¬ì ë° ë³¸ì‚¬ì— ì•Œë¦¼ ì „ì†¡ Â· ìœ„í—˜ìš”ì¸ ì‹ ê³  ì ˆì°¨ì™€ ë™ì¼í•˜ê²Œ ì²˜ë¦¬ / ë°ëª¨)");
      });
    }

    if (mobileStopClose) {
      mobileStopClose.addEventListener("click", closeMobileStopModal);
    }

    if (mobileStopModal) {
      mobileStopModal.addEventListener("click", (e) => {
        if (e.target === mobileStopModal) {
          closeMobileStopModal();
        }
      });
    }

    if (mobileFinishBtn) {
      mobileFinishBtn.addEventListener("click", () => {
        if (!mobileFinishEnabled) {
          alert("ì‘ì—…ì§€ì‹œ í™”ë©´ì—ì„œ ì„œëª…/í™•ì¸ í›„ ì‘ì—… ì¢…ë£Œë¥¼ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
          return;
        }
        openMobileStopModal();
      });
    }

    if (mobileStopYesBtn) {
      mobileStopYesBtn.addEventListener("click", () => {
        mobileStopStepQuestion.style.display = "none";
        mobileStopStepYes.style.display = "flex";
        mobileStopStepNo.style.display = "none";
        mobileStopSignInput.value = "";
      });
    }

    if (mobileStopNoBtn) {
      mobileStopNoBtn.addEventListener("click", () => {
        mobileStopStepQuestion.style.display = "none";
        mobileStopStepYes.style.display = "none";
        mobileStopStepNo.style.display = "flex";
        mobileStopIssueInput.value = "";
      });
    }

    if (mobileStopYesSave) {
      mobileStopYesSave.addEventListener("click", () => {
        const signName = mobileStopSignInput.value.trim() || "ì„œëª… ì—†ìŒ";
        const now = new Date();
        const wo = mockData.workOrders[0];
        mockData.safeLog.push({
          worker: wo.workerName,
          location: wo.location,
          startTime: currentWorkStartTime ? currentWorkStartTime.toLocaleTimeString() : "-",
          endTime: now.toLocaleTimeString(),
          signature: signName
        });
        closeMobileStopModal();
        alert("ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤. (ë¬´ì‚¬ê³ ì¼ì§€ì— ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.)");
      });
    }

    if (mobileStopNoSave) {
      mobileStopNoSave.addEventListener("click", () => {
        const issueText = mobileStopIssueInput.value.trim();
        if (issueText) {
          const now = new Date();
          const wo = mockData.workOrders[0];
          mockData.safeLog.push({
            worker: wo.workerName,
            location: wo.location,
            startTime: currentWorkStartTime ? currentWorkStartTime.toLocaleTimeString() : "-",
            endTime: now.toLocaleTimeString(),
            issue: issueText
          });
        }
        closeMobileStopModal();
        alert("íŠ¹ì´ì‚¬í•­ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
      });
    }

    // ----- ìœ„í—˜ì„±í‰ê°€ D/B í…Œì´ë¸” ë Œë”ë§ -----
    function renderRiskDbTable() {
      const tbody = document.getElementById("riskDbTableBody");
      if (!tbody) return;
      tbody.innerHTML = mockData.riskDb
        .map(
          (r) => `
        <tr>
          <td>${r.taskName}</td>
          <td>${r.risks.join("<br>")}</td>
        </tr>
      `
        )
        .join("");
    }

    // ----- ì‘ì—…ì§€ì‹œ ì‘ì—…ëª… ì…ë ¥ â†’ ìœ„í—˜ì„±í‰ê°€ ì¶”ì²œ ë“œë¡­ë‹¤ìš´ -----
    function attachTaskSuggestHandlers() {
      const inputs = document.querySelectorAll(".task-input");
      inputs.forEach((input) => {
        const id = input.getAttribute("data-id"); // workerWorkOrderId (ë¬¸ìì—´)
        const list = document.querySelector(`.task-suggest-list[data-id="${id}"]`);
        if (!list) return;

        input.addEventListener("input", () => {
          const q = input.value.trim();
          const lower = q.toLowerCase();
          if (q.length < 2) {
            list.style.display = "none";
            list.innerHTML = "";
            return;
          }
          const matches = mockData.riskDb.filter(
            (r) =>
              r.taskName.toLowerCase().includes(lower) ||
              r.keyword.toLowerCase().includes(lower)
          );
          if (matches.length === 0) {
            list.style.display = "none";
            list.innerHTML = "";
            return;
          }
          list.innerHTML = matches
            .map(
              (m) => `
            <div class="task-suggest-item" data-task-id="${m.id}">
              ${m.taskName}
            </div>
          `
            )
            .join("");
          list.style.display = "block";

          list.querySelectorAll(".task-suggest-item").forEach((item) => {
            item.addEventListener("click", () => {
              const taskId = Number(item.getAttribute("data-task-id"));
              const risk = mockData.riskDb.find((r) => r.id === taskId);
              // workerWorkOrderId í˜•ì‹: "workOrderId_workerId"
              const parts = id.split("_");
              const workOrderId = Number(parts[0]);
              const wo = mockData.workOrders.find((w) => w.id === workOrderId);
              if (risk && wo) {
                wo.task = risk.taskName;
                wo.risks = [...risk.risks];
                wo.measures = [...(risk.measures || [])];
                input.value = risk.taskName;
                list.style.display = "none";
                list.innerHTML = "";
                // ì„ íƒ ì¦‰ì‹œ í…Œì´ë¸”ì„ ë‹¤ì‹œ ê·¸ë ¤ì„œ ìœ„í—˜ìš”ì¸/ëŒ€ì±… ì¹¸ ë°˜ì˜
                renderWorkOrderTable();
              }
            });
          });
        });

        // í¬ì»¤ìŠ¤ ë°–ìœ¼ë¡œ ë‚˜ê°€ë©´ ë‹«ê¸° (ì•½ê°„ ì§€ì—°)
        input.addEventListener("blur", () => {
          setTimeout(() => {
            list.style.display = "none";
          }, 200);
        });
      });
    }

    // ì´ˆê¸° ë Œë”ë§
    renderWorkOrderTable();
    renderRiskDbTable();

    // ----- ë³¸ì‚¬ ëŒ€ì‹œë³´ë“œ ì§€ë„ í´ë¦­ â†’ í˜„ì¥ ëŒ€ì‹œë³´ë“œë¡œ ì´ë™ -----
    const hqMapClick = document.getElementById("hqMapClick");
    const siteBackBtn = document.getElementById("siteBackBtn");
    const resetWorkOrdersBtn = document.getElementById("resetWorkOrdersBtn");

    function openSiteDashboard() {
      // DOM ìš”ì†Œ ë‹¤ì‹œ ì°¾ê¸° (ì•ˆì „ì„± í™•ë³´)
      const allViews = document.querySelectorAll(".view");
      const allMenuItems = document.querySelectorAll(".menu-item");
      const titleEl = document.getElementById("topbarTitle");
      const subEl = document.getElementById("topbarSub");

      // ì™¼ìª½ ë©”ë‰´ëŠ” 1ë²ˆ(ëŒ€ì‹œë³´ë“œ)ì„ ìœ ì§€í•œ ì±„ ë·°ë§Œ êµì²´
      allViews.forEach((v) => {
        if (v.id === "view-site") {
          v.classList.add("active");
        } else {
          v.classList.remove("active");
        }
      });
      
      allMenuItems.forEach((item) => {
        if (item.getAttribute("data-view") === "menu1") {
          item.classList.add("active");
        } else if (item.getAttribute("data-view") !== "workorders") {
          // ë‚˜ë¨¸ì§€ëŠ” í•´ì œ (workordersëŠ” í•„ìš” ì‹œ ìœ ì§€)
          item.classList.remove("active");
        }
      });
      
      if (titleEl) {
        titleEl.textContent = "í˜„ì¥ ëŒ€ì‹œë³´ë“œ Â· ì¸ì²œ 1êµ¬ì—­";
      }
      if (subEl) {
        subEl.textContent = "102ë™ 2ì½”ì–´ ë™ë ¥ê°„ì„  ì‘ì—…ì„ ì¤‘ì‹¬ìœ¼ë¡œ TBM/ìœ„í—˜ì„±í‰ê°€Â·ì‚¬ê³  í˜„í™©ì„ í™•ì¸í•©ë‹ˆë‹¤.";
      }
    }

    // ì§€ë„ í´ë¦­ ì´ë²¤íŠ¸ (ì—¬ëŸ¬ ë°©ë²•ìœ¼ë¡œ ì—°ê²°)
    if (hqMapClick) {
      hqMapClick.addEventListener("click", (e) => {
        e.preventDefault();
        e.stopPropagation();
        openSiteDashboard();
      });
    }

    // DOMContentLoadedì—ì„œë„ ì—°ê²°
    document.addEventListener("DOMContentLoaded", () => {
      const hqMapClickEl = document.getElementById("hqMapClick");
      if (hqMapClickEl) {
        hqMapClickEl.addEventListener("click", (e) => {
          e.preventDefault();
          e.stopPropagation();
          openSiteDashboard();
        });
      }
    });

    if (siteBackBtn) {
      siteBackBtn.addEventListener("click", () => {
        switchView("menu1");
      });
    }

    if (resetWorkOrdersBtn) {
      resetWorkOrdersBtn.addEventListener("click", () => {
        // ì‘ì—…ì§€ì‹œ/ìœ„í—˜ìš”ì¸/ëŒ€ì±…/ì„œëª… ìƒíƒœ ì´ˆê¸°í™”
        mockData.workOrders.forEach((wo) => {
          wo.task = "";
          wo.risks = [];
          wo.measures = [];
        });
        Object.keys(workOrderState).forEach((k) => delete workOrderState[k]);
        renderWorkOrderTable();
      });
    }

    // ----- ìœ„í—˜ì„±í‰ê°€ DB ì†ŒìŠ¤ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì œì–´ -----
    const dbSourceSelect = document.getElementById("dbSourceSelect");
    const dbSourceBadge = document.getElementById("dbSourceBadge");

    if (dbSourceSelect && dbSourceBadge) {
      dbSourceSelect.addEventListener("change", (e) => {
        const value = e.target.value;
        // ë°°ì§€ í…ìŠ¤íŠ¸ ë° ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸ (ì‹œê°ì  í”¼ë“œë°±ë§Œ)
        dbSourceBadge.className = "db-source-badge";
        if (value === "default") {
          dbSourceBadge.textContent = "ê¸°ë³¸ DB í™œì„±";
          dbSourceBadge.classList.remove("client", "custom");
        } else if (value === "client") {
          dbSourceBadge.textContent = "ë°œì£¼ì²˜ DB í™œì„±";
          dbSourceBadge.classList.add("client");
        } else if (value === "custom") {
          dbSourceBadge.textContent = "ì§ì ‘ ì…ë ¥ ëª¨ë“œ";
          dbSourceBadge.classList.add("custom");
        }
        // ì‹¤ì œ ë°ì´í„° ë³€ê²½ì€ í•˜ì§€ ì•ŠìŒ (ì‹œê°ì  ë°ëª¨ë§Œ)
      });
    }

    // ----- AI ê²€í†  ëª¨ë‹¬ ì œì–´ -----
    const aiReviewModal = document.getElementById("aiReviewModal");
    const aiReviewClose = document.getElementById("aiReviewClose");
    const aiReportedRisk = document.getElementById("aiReportedRisk");
    const aiAnalysisText = document.getElementById("aiAnalysisText");
    const aiMeasureText = document.getElementById("aiMeasureText");
    const aiAdoptBtn = document.getElementById("aiAdoptBtn");
    const aiSaveToDbBtn = document.getElementById("aiSaveToDbBtn");

    let currentAIWorkId = null;
    let currentAIFeedback = null;

    // AI ë¶„ì„ ì‹œë®¬ë ˆì´ì…˜ í•¨ìˆ˜ (1ì´ˆ ì§€ì—° í›„ ê²°ê³¼ ë°˜í™˜)
    function simulateAI(feedbackText) {
      return new Promise((resolve) => {
        setTimeout(() => {
          // ê°„ë‹¨í•œ AI ë¶„ì„ ë¡œì§ ì‹œë®¬ë ˆì´ì…˜
          let analysis = "";
          let measure = "";

          if (feedbackText.includes("ì „ì„ ") || feedbackText.includes("ì¼€ì´ë¸”") || feedbackText.includes("ì„ ")) {
            analysis = "í•´ë‹¹ ê³µì •ì—ì„œ 'ì „ë„(ë„˜ì–´ì§)' ì‚¬ê³  ë°œìƒ í™•ë¥ ì´ ë†’ìŠµë‹ˆë‹¤.";
            measure = "ì „ì„  ì •ë¦¬ ê±°ì¹˜ëŒ€ ì„¤ì¹˜ ë° í†µë¡œ í™•ë³´, ì¼€ì´ë¸” íŠ¸ë ˆì´ ì •ë¦¬ ì‘ì—… ì¶”ê°€ ì§€ì‹œ.";
          } else if (feedbackText.includes("ë°”ë‹¥") || feedbackText.includes("ë¯¸ë„ëŸ¬")) {
            analysis = "ë¯¸ë„ëŸ¬ì§ ì‚¬ê³  ìœ„í—˜ì´ ë†’ìŠµë‹ˆë‹¤.";
            measure = "ë°”ë‹¥ ì²­ì†Œ ë° ë¯¸ë„ëŸ¼ ë°©ì§€ ë§¤íŠ¸ ì„¤ì¹˜, ì‘ì—… êµ¬ì—­ ì •ë¦¬ ì§€ì‹œ.";
          } else if (feedbackText.includes("ì¡°ëª…") || feedbackText.includes("ì–´ë‘¡")) {
            analysis = "ì‹œì•¼ ë¶ˆëŸ‰ìœ¼ë¡œ ì¸í•œ ì‘ì—… ì˜¤ë¥˜ ë° ì‚¬ê³  ìœ„í—˜ì´ ìˆìŠµë‹ˆë‹¤.";
            measure = "ì„ì‹œ ì¡°ëª… ì¶”ê°€ ì„¤ì¹˜, ì‘ì—… êµ¬ì—­ ì¡°ëª… ê°•í™” ì§€ì‹œ.";
          } else {
            analysis = "ê·¼ë¡œì ì œë³´ ë‚´ìš©ì„ ë¶„ì„í•œ ê²°ê³¼, ì¶”ê°€ ì•ˆì „ ì¡°ì¹˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.";
            measure = "í•´ë‹¹ ìœ„í—˜ìš”ì¸ì— ëŒ€í•œ êµ¬ì²´ì  ëŒ€ì±… ìˆ˜ë¦½ ë° í˜„ì¥ ì ê²€ ì‹¤ì‹œ.";
          }

          resolve({ analysis, measure });
        }, 1000);
      });
    }

    async function openAIReviewModal(workId, feedbackText) {
      if (!aiReviewModal) return;
      currentAIWorkId = workId;
      currentAIFeedback = feedbackText;

      // ê·¼ë¡œì ì œë³´ ë‚´ìš© í‘œì‹œ
      if (aiReportedRisk) {
        aiReportedRisk.innerHTML = `<div style="color:#e5e7eb;font-size:12px;line-height:1.6;">${feedbackText}</div>`;
      }

      // AI ë¶„ì„ ì¤‘ í‘œì‹œ
      if (aiAnalysisText) {
        aiAnalysisText.textContent = "AI ë¶„ì„ ì¤‘...";
      }
      if (aiMeasureText) {
        aiMeasureText.textContent = "ëŒ€ì±… ìƒì„± ì¤‘...";
      }

      // AI ë¶„ì„ ì‹œë®¬ë ˆì´ì…˜
      const aiResult = await simulateAI(feedbackText);

      // AI ë¶„ì„ ê²°ê³¼ í‘œì‹œ
      if (aiAnalysisText) {
        aiAnalysisText.textContent = aiResult.analysis;
      }
      if (aiMeasureText) {
        aiMeasureText.textContent = aiResult.measure;
      }

      aiReviewModal.style.display = "flex";
    }

    function closeAIReviewModal() {
      if (aiReviewModal) {
        aiReviewModal.style.display = "none";
        currentAIWorkId = null;
        currentAIFeedback = null;
      }
    }

    if (aiReviewClose) {
      aiReviewClose.addEventListener("click", closeAIReviewModal);
    }

    if (aiReviewModal) {
      aiReviewModal.addEventListener("click", (e) => {
        if (e.target === aiReviewModal) {
          closeAIReviewModal();
        }
      });
    }

    // AI ëŒ€ì±… ì±„íƒ ë²„íŠ¼
    if (aiAdoptBtn) {
      aiAdoptBtn.addEventListener("click", () => {
        if (currentAIWorkId && aiMeasureText) {
          // workerWorkOrderId í˜•ì‹: "workOrderId_workerId"
          const parts = currentAIWorkId.split("_");
          const workOrderId = Number(parts[0]);
          const wo = mockData.workOrders.find((w) => w.id === workOrderId);
          if (wo) {
            // ëŒ€ì±… í•„ë“œì— AI ì¶”ì²œ ëŒ€ì±… ì¶”ê°€
            const aiMeasure = aiMeasureText.textContent;
            if (!wo.measures) {
              wo.measures = [];
            }
            if (!wo.measures.includes(aiMeasure)) {
              wo.measures.push(aiMeasure);
            }
            // í…Œì´ë¸” ì—…ë°ì´íŠ¸
            renderWorkOrderTable();
            showToastMessage("âœ… AI ì¶”ì²œ ëŒ€ì±…ì´ ì‘ì—…ì§€ì‹œì— ë°˜ì˜ë˜ì—ˆìŠµë‹ˆë‹¤.");
            closeAIReviewModal();
          }
        }
      });
    }

    // DBì— ì¶•ì  ë²„íŠ¼
    if (aiSaveToDbBtn) {
      aiSaveToDbBtn.addEventListener("click", () => {
        showToastMessage("âœ… í•´ë‹¹ ë°ì´í„°ê°€ ìœ„í—˜ì„±í‰ê°€ DB(ì§€ëŠ¥í˜•)ì— ìì‚°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.");
        // needsAIReview í”Œë˜ê·¸ ì œê±° (ê²€í†  ì™„ë£Œ)
        if (currentAIWorkId && workOrderState[currentAIWorkId]) {
          if (typeof workOrderState[currentAIWorkId] === 'object') {
            workOrderState[currentAIWorkId].needsAIReview = false;
          }
        }
        renderWorkOrderTable();
        setTimeout(() => {
          closeAIReviewModal();
        }, 2000);
      });
    }
  </script>

  <!-- ê³ ì • í‘¸í„° (ì €ì‘ê¶Œ ì •ë³´) -->
  <div class="copyright-footer">
    <strong>Made by Jung Sangik</strong> | System Architecture & Logic Designed by Jung Sangik | Â© 2025 All Rights Reserved.
  </div>
</body>
</html>


